%============================================================================
% LaTeX File
% Daniel J. Greenhoe
%============================================================================
%--------------------------------------
% Compile control
%--------------------------------------
\ProvidesPackage{dan}

%--------------------------------------
% default bullet marks
%--------------------------------------
\newcommand{\imark}{\includegraphics*[height=3mm]{../common/graphics/watercraft/ghind_blue.pdf}}%
\newcommand{\imarks}{\includegraphics*[height=3mm]{../common/graphics/watercraft/ghind_blue.pdf}\;}%
\newcommand{\imarkL}{\includegraphics*[height=4.1mm]{../common/graphics/watercraft/ghind_blue.pdf}}%

\newcommand{\ccby}{\includegraphics*{../common/graphics/cc/ccby40djg.pdf}}
\newcommand{\ccbyncnd}{\includegraphics*{../common/graphics/cc/ccbyncnd40djg.pdf}}

%--------------------------------------
% stamps
%--------------------------------------
 \newcommand{\datestamp}{{\dateLong\today}}
 \newcommand{\timestamp}{{\dateLong\today} {\settimeformat{timeUTC}\currenttime}}
 \newcommand{\copyrightstamp}{Copyright {\textcopyright} {\dateYear\today} Daniel J. Greenhoe}
 \newcommand{\copyrightshort}{Copyright {\textcopyright} {\dateYear\today} Daniel J. Greenhoe}
 \newcommand{\cstamp}{{\textcopyright} {\dateYear\today} Daniel J. Greenhoe}
 \newcommand{\versionstamp}{\fntDigital{Version} {\version}}
 \newcommand{\CCBYNCNDstatement}{%
   \href{https://creativecommons.org/}{Creative Commons} license 
   \href{https://creativecommons.org/licenses/}{CC BY-NC-ND 4.0}
   }%

%--------------------------------------
% header information
%--------------------------------------
\fancyhf[HOL,HOR,HEL,HER]{}%
\fancyhf[HEC]{% header even pages
    \setlength{\arrayrulewidth}{0.5pt}%
    \arrayrulecolor{gray}%
    \begin{tabular}{|p{24.74mm}|p{40mm}|p{\tw-78mm}|}%
      \hline%
        \sffamily\small{page~\thepage}
       &\sffamily\footnotesize\centering Daniel J. Greenhoe %
       &\sffamily\footnotesize\scshape\mbox{}\hfill\leftmark\mbox{}%
      \\\hline\hline
    \end{tabular}}%
\fancyhf[HOC]{% header odd pages
    \setlength{\arrayrulewidth}{0.5pt}%
    \arrayrulecolor{gray}%
    \begin{tabular}{|p{\tw-78mm}|p{40mm}|p{24.74mm}|}%
      \hline%
        \sffamily\footnotesize\scshape\rightmark%
       &\sffamily\footnotesize\centering Daniel J. Greenhoe %
       &\sffamily\small\mbox{}\hfill{page~\thepage}\mbox{}
      \\\hline\hline
    \end{tabular}}%
\fancyhf[FOL,FOR,FEL,FER]{}%
       % |||
       % |||______ L=left       C=center     R=right
       % ||_______ E=even page  O=odd page
       % |________ H=header     F=footer

%--------------------------------------
% footer information with url
%--------------------------------------
\newcommand{\footerinfou}[2]{%
  \fancyhf[FEC]{%
    \scriptsize%
    \sffamily%
    \setlength{\arrayrulewidth}{0.5pt}%
    \arrayrulecolor{gray}%
    \begin{tabular*}{\textwidth}{|c@{\extracolsep\fill}|c|c|}%
      \hline\hline%
      %--------------------------------
      % even page left footer box: license
      %--------------------------------
      \tbox{\href{https://creativecommons.org/licenses/by-nc-nd/4.0/}%
            {\ccbyncnd}%
            }%
      %--------------------------------
      % even page center footer box: tags
      %--------------------------------
      &\tboxc{%
         \tboxc{\imarkL}\hspace{3pt}%
         \tboxc{#1 \fntDigital[version \version]}%
         \hspace{3pt}\tboxc{\imarkL}%
         \\\url{#2}}%
      %--------------------------------
      % even page right footer box: copyright
      %--------------------------------
      &\scshape\tbox{\timestamp\\\copyrightshort}%
      \\\hline%
    \end{tabular*}}%
  \fancyhf[FOC]{%
    \scriptsize%
    \sffamily%
    \setlength{\arrayrulewidth}{0.5pt}%
    \arrayrulecolor{gray}%
    \begin{tabular*}{\textwidth}{|c@{\extracolsep\fill}|c|c|}%
      \hline\hline%
      %--------------------------------
      % odd page left footer box: copyright
      %--------------------------------
      \scshape\tbox{\timestamp\\\copyrightshort}%
      %--------------------------------
      % odd page center footer box: tags
      %--------------------------------
      &\tboxc{%
         \tboxc{\imarkL}\hspace{3pt}%
         \tboxc{#1 \fntDigital[version \version]}%
         \hspace{3pt}\tboxc{\imarkL}%
         \\\url{#2}}%
      %--------------------------------
      % odd page right footer box: license
      %--------------------------------
      &\tboxc{\href{https://creativecommons.org/licenses/by-nc-nd/4.0/}%
             {\ccbyncnd}}%
      \\\hline%
    \end{tabular*}}%
  }%

%--------------------------------------
% footer information with url
%--------------------------------------
\newcommand{\footerinfoCCby}[2]{%
  \fancyhf[FEC]{%
    \scriptsize%
    \sffamily%
    \setlength{\arrayrulewidth}{0.5pt}%
    \arrayrulecolor{gray}%
    \begin{tabular*}{\textwidth}{|c@{\extracolsep\fill}|c|c|}%
      \hline\hline%
      %--------------------------------
      % even page left footer box: license
      %--------------------------------
      \tbox{\href{https://creativecommons.org/licenses/by/4.0/}{\ccby}}%
      %--------------------------------
      % even page center footer box: tags
      %--------------------------------
      &\tboxc{%
         \tboxc{\imarkL}\hspace{3pt}%
         \tboxc{#1 \fntDigital[version \version]}%
         \hspace{3pt}\tboxc{\imarkL}%
         \\\url{#2}}%
      %--------------------------------
      % even page right footer box: copyright
      %--------------------------------
      &\scshape\tbox{\timestamp\\\copyrightshort}%
      \\\hline%
    \end{tabular*}}%
  \fancyhf[FOC]{%
    \scriptsize%
    \sffamily%
    \setlength{\arrayrulewidth}{0.5pt}%
    \arrayrulecolor{gray}%
    \begin{tabular*}{\textwidth}{|c@{\extracolsep\fill}|c|c|}%
      \hline\hline%
      %--------------------------------
      % odd page left footer box: copyright
      %--------------------------------
      \scshape\tbox{\timestamp\\\copyrightshort}%
      %--------------------------------
      % odd page center footer box: tags
      %--------------------------------
      &\tboxc{%
         \tboxc{\imarkL}\hspace{3pt}%
         \tboxc{#1 \fntDigital[version \version]}%
         \hspace{3pt}\tboxc{\imarkL}%
         \\\url{#2}}%
      %--------------------------------
      % odd page right footer box: license
      %--------------------------------
      &\tboxc{\href{https://creativecommons.org/licenses/by/4.0/}{\ccby}}%
      \\\hline%
    \end{tabular*}}%
  }%

%--------------------------------------
% footer information
%--------------------------------------
\newcommand{\footerinfo}[3]{%
  \fancyhf[FEC]{% footer even pages
    \scriptsize%
    \setlength{\arrayrulewidth}{0.5pt}%
    \arrayrulecolor{gray}%
    \begin{tabular*}{\tw}{|c@{\extracolsep\fill}|c|c|}%
      \hline\hline%
        \tbox{\href{https://creativecommons.org/licenses/by-nc-nd/4.0/}{\ccbyncnd}}
         &\fntAdventor\tbox{\imarkL\tbox{#2\\#3\\\fntDigital version\hspace{1ex}\version}\imarkL}%
       &\sffamily\scshape\tbox{\timestamp\\\copyrightshort}%
      \\\hline%
    \end{tabular*}}%
  \fancyhf[FOC]{% footer odd pages
      \scriptsize%
      \setlength{\arrayrulewidth}{0.5pt}%
      \arrayrulecolor{gray}%
      \begin{tabular*}{\tw}{|c@{\extracolsep\fill}|c|c|}%
        \hline\hline%
          \sffamily\scshape\tbox{\timestamp\\\copyrightshort}%
         &\fntAdventor\tbox{\imarkL\tbox{#2\\#3\\\fntDigital version\hspace{1ex}\version}\imarkL}%
         &\tbox{\href{https://creativecommons.org/licenses/by-nc-nd/4.0/}{\ccbyncnd}}
        \\\hline%
      \end{tabular*}}%
  }% end \footerinfo


%--------------------------------------
% lengths
%--------------------------------------
\newcommand{\forcommand}[2][0]{\providecommand{#2}{}\renewcommand{#2}[#1]}% force a new command whether predefined or not; 2014may15thrs
%--------------------------------------
% Counters
%--------------------------------------
\newcounter{cntr}% generic counter
\newcounter{cnta}% alternative counter a --- for use inside user defined environments
\newcounter{cntb}% alternative counter b --- for use inside user defined environments
\newcounter{cntc}% alternative counter  --- for use inside user defined environments
\newcounter{cntd}% alternative counter  --- for use inside user defined environments
\newcounter{cnte}% alternative counter  --- for use inside user defined environments
\newcounter{cntf}% alternative counter  --- for use inside user defined environments
\newcounter{arga}% argument a            --- for use inside user defined environments
\newcommand{\cntreset}{\setcounter{cntr}{0}}
\newcommand{\cnto}{\cntreset\refstepcounter{cntr}\arabic{cntr}.}%
\newcommand{\cntos}{{\cntreset\refstepcounter{cntr}\scriptsize\arabic{cntr}.}}%
\newcommand{\cntx}{\refstepcounter{cntr}\arabic{cntr}.}%
\newcommand{\cntxs}{{\refstepcounter{cntr}\scriptsize\arabic{cntr}.}}%
\newcommand{\cntn}{\refstepcounter{cntr}\tabularnewline\arabic{cntr}.} %
\newcommand{\cnth}{\refstepcounter{cntr}\tabularnewline\hline\arabic{cntr}.} %
\newcommand{\cnthh}{\refstepcounter{cntr}\tabularnewline\hline\hline\arabic{cntr}.} %
\newcommand{\cntc}{\refstepcounter{cntr}&\arabic{cntr}.} %
\newcommand{\cntAo}{\cntreset\refstepcounter{cntr}\Alph{cntr}.}%
\newcommand{\cntAx}{\refstepcounter{cntr}\Alph{cntr}.}%
\newcommand{\cntA}{\refstepcounter{cntr}\Alph{cntr}}%
\newcommand{\cntAn}{\refstepcounter{cntr}\tabularnewline\Alph{cntr}.} %
\newcommand{\cntAh}{\refstepcounter{cntr}\tabularnewline\hline\Alph{cntr}.} %
\newcommand{\cntAhh}{\refstepcounter{cntr}\tabularnewline\hline\hline\Alph{cntr}.} %
\newcommand{\cntAc}{\refstepcounter{cntr}&\arabic{cntr}.} %

\newcounter{mpcntr}% main point counter
\newcommand{\mpcntreset}{\setcounter{mpcntr}{0}}
\newcommand{\mpdec}{\addtocounter{mpcntr}{-1}}
\newcommand{\mpcnt}{\refstepcounter{mpcntr}\Roman{mpcntr}. } %

\newcounter{gcntr}% grammar rule counter
\newcommand{\gcntreset}{\setcounter{gcntr}{0}}
\newcommand{\grule}[1]{\refstepcounter{gcntr}{\fnthw Rule \arabic{gcntr}: #1}}
\newcommand{\ezp}[2]{\refstepcounter{gcntr}{\fnthw\raggedright Principle \arabic{gcntr}: #1} ({\fntzhr #2})\newline}

\newcounter{cntrLesson}
\newcommand{\cntrLessonReset}{\setcounter{cntrLesson}{0}}

\newcounter{cntrIndex}
\newcommand{\cntrIndexReset}{\setcounter{cntrIndex}{0}}

%--------------------------------------
% text typesetting
%--------------------------------------
\newcommand{\tw}{\textwidth}
\newcommand{\ragr}{\raggedright}
\newcommand{\hs}{\hspace}
\renewcommand{\bf}{\bfseries}
\newcommand{\mc}[3]{\multicolumn{#1}{#2}{#3}}
\newcommand{\propsize}{\scriptsize}
\newcommand{\tfill}{\extracolsep\fill}% tabular* column fill
\newcommand{\scs}{\scriptsize}%
\newcommand{\scy}{\scriptstyle}%
\newcommand{\fns}{\footnotesize}%
\newcommand{\gsize}{\normalsize}% font size for graphics
\newcommand{\gsizes}{\footnotesize}% small font size for graphics
\newcommand{\scell}{\cellcolor{shadedcell}}
\newcommand{\abox}[1]{\begin{array}{c}#1\end{array}}% useful for properly centered vertical alignment
\newcommand{\aboxc}[1]{\begin{array}{@{}c@{}}#1\end{array}}% useful for properly centered vertical alignment
\newcommand{\tbox}[1]{\begin{tabular}{c}#1\end{tabular}}% useful for properly centered vertical alignment
\newcommand{\tboxc}[1]{\begin{tabular}{@{}c@{}}#1\end{tabular}}% useful for properly centered vertical alignment
\newcommand{\ftbox}[1]{\begin{tabular}{|c|}\hline#1\\\hline\end{tabular}}% framed \tbox{}
\newcommand{\ftboxc}[1]{\begin{tabular}{|@{}c@{}|}\hline#1\\\hline\end{tabular}}% framed \tboxc
%=======================================
% tabular support
%=======================================
\newcolumntype{R}{>{\cellcolor{red}\upshape\bfseries\color{white}}c}
\newcolumntype{G}{>{\cellcolor{tblgreen}\upshape\bfseries\color{white}}c}
\newcolumntype{B}{>{\cellcolor{blue}\upshape\bfseries\color{white}}c}
\newcolumntype{P}{>{\cellcolor{purple}\upshape\bfseries\color{white}}c}
\newcolumntype{g}{>{\cellcolor{gray}\upshape\bfseries\color{black}}c}
\newcolumntype{X}{>{\cellcolor{red}$\upshape\bfseries\color{white}}c<{$}}
\newcolumntype{Y}{>{\cellcolor{green}$\upshape\bfseries\color{white}}c<{$}}
\newcolumntype{Z}{>{\cellcolor{blue}$\upshape\bfseries\color{white}}c<{$}}

\newcolumntype{C}{>{\scriptstyle}l}
\newcolumntype{D}{>{$\scriptsize}l<{$}}
\newcolumntype{H}{>{$\scriptsize}c<{$}}
\newcolumntype{F}{>{$\scriptsize}r<{$}}
\newcolumntype{E}{>{\scriptsize}l}
\newcolumntype{L}{>{\displaystyle}l}
\newcolumntype{M}{>{$}l<{$}}
\newcolumntype{N}{>{$}c<{$}}
\newcolumntype{O}{>{$}r<{$}}
\newcolumntype{z}{>{\zhtzye}l}

\newcommand{\tblx}{\mbox{}} % empty placeholder command
\newcommand{\tbln}{\tabularnewline} % tabular new line
\newcommand{\tblh}{\tabularnewline\hline} % tabular new line and horizontal line
\newcommand{\tblc}{&} % tabular new column

\newenvironment{tabstr}[1]
  {\renewcommand{\arraystretch}{#1}}
  {\renewcommand{\arraystretch}{1}}

%=======================================
% Citation Support
%=======================================
% General citation
%----------------
\newcommand{\citetbl}   [1]{\footnote{\begin{tabular}[t]{ll}#1\end{tabular}}} % citation table
\newcommand{\citetblp}  [1]{\footnote{\begin{tabular}[t]{p{\tw-10mm}}#1\end{tabular}}} % citation table
\newcommand{\citetbllp} [2][30mm]{\footnote{\begin{tabular}[t]{lp{\tw-#1}}#2\end{tabular}}} % citation table
\newcommand{\citetblt}  [1]{\footnotetext{\begin{tabular}[t]{ll}#1\end{tabular}}} % citation table for \footnotetext environment
\newcommand{\citetbltbl}[1]{\footnotetext{\begin{tabular}[t]{ll}#1\end{tabular}}} % citation table for \footnotetext environment
\newcommand{\citetblf}  [1]{\begin{tabular}[t]{ll}#1\end{tabular}} % citation table for \footnotetext environment

\newcommand{\citebullet}{{\scriptsize\book}}% bullet for book references
\newcommand{\citePbullet}{{\scriptsize\pagec}}% bullet for journal paper references
\newcommand{\citeIbullet}{{\scriptsize\notebook}}% bullet for incollection references (e.g. a paper in a book)
\newcommand{\citeWbullet}{{\scriptsize\computer}}% bullet for web resource
\newcommand{\citeFbullet}{{\scriptsize\floppydisk}}% bullet for data file
\newcommand{\citeSbullet}{{\scriptsize\floppydisk}}% bullet for source code support
\newcommand{\crossrefbullet}{{\scriptsize\booko}}% bullet for cross references
\newcommand{\lcomdelim}{$\langle$} % left  comment delimeter
\newcommand{\rcomdelim}{$\rangle$} % right comment delimeter

%---------------------------------------
% book citations
%---------------------------------------
\newcommand{\fullcite}{\cite}
\newcommand{\citefull}[1]{\citebullet\;\fullcite{#1}\index[xref]{{\cite{#1}}}}
\newcommand{\citer}   [1]{\citebullet\;\cite{#1}\index[xref]{{\cite{#1}}}}          % citation table entry with only reference (no page number)
\newcommand{\citerp}  [2]{\citebullet\;\cite{#1} page~#2\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citerps} [2]{\citebullet\;\cite{#1} pages #2\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citerpp} [3]{\citebullet\;\cite{#1} pages #2--#3\index[xref]{{\cite{#1}}}} % citation table entry with ref and page range
\newcommand{\citerc}  [2]{\citebullet\;\cite{#1} \lcomdelim#2\rcomdelim} % citation table entry with ref and one comment
\newcommand{\citeru}  [2]{\citebullet\;\cite{#1} \lcomdelim\url{#2}\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one comment
\newcommand{\citeruc} [3]{\citebullet\;\cite{#1} \lcomdelim\url{#2}\rcomdelim \lcomdelim#3\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one comment
\newcommand{\citerpc} [3]{\citebullet\;\cite{#1} page~#2 \lcomdelim#3\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citerppc}[4]{\citebullet\;\cite{#1} pages #2--#3 \lcomdelim#4\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page

%---------------------------------------
% OEIS citations
%---------------------------------------
\newcommand{\citeO}  [2]{{\scs\citeWbullet}\;\cite{#1}\;\url{http://oeis.org/#2}} % OEIS citation
\newcommand{\citeOc} [3]{{\scs\citeWbullet}\;\cite{#1}\;\url{http://oeis.org/#2}\;\lcomdelim{#3}\rcomdelim} % OEIS citation

%---------------------------------------
% Data citations
%---------------------------------------
\newcommand{\citeD}  [1]{{\scs\citeFbullet}\;\cite{#1}}
\newcommand{\citeDc} [2]{{\scs\citeFbullet}\;\cite{#1} \lcomdelim{#2}\rcomdelim}

%---------------------------------------
% Source code citations
%---------------------------------------
\newcommand{\citeS}  [1]{{\scs\citeSbullet}\;\cite{#1}}
\newcommand{\citeSc} [2]{{\scs\citeSbullet}\;\cite{#1} \lcomdelim{#2}\rcomdelim}
%---------------------------------------
% paper citations
%---------------------------------------
\newcommand{\citePfull}[1]{\citePbullet\;\fullcite{#1}\index[xref]{{\cite{#1}}}}          % citation table entry with only reference (no page number)
\newcommand{\citeP}    [1]{\citePbullet\;\cite{#1}\index[xref]{{\cite{#1}}}}          % citation table entry with only reference (no page number)
\newcommand{\citePp}   [2]{\citePbullet\;\cite{#1} page~#2\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citePps}  [2]{\citePbullet\;\cite{#1} pages #2\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citePpp}  [3]{\citePbullet\;\cite{#1} pages #2--#3\index[xref]{{\cite{#1}}}} % citation table entry with ref and page range
\newcommand{\citePc}   [2]{\citePbullet\;\cite{#1} \lcomdelim#2\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one comment
\newcommand{\citePu}   [2]{\citePbullet\;\cite{#1} \lcomdelim\url{#2}\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one comment
\newcommand{\citePuc}  [3]{\citePbullet\;\cite{#1} \lcomdelim\url{#2}\rcomdelim \lcomdelim#3\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one comment
\newcommand{\citePpc}  [3]{\citePbullet\;\cite{#1} page~#2 \lcomdelim#3\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citePppc} [4]{\citePbullet\;\cite{#1} pages #2--#3 \lcomdelim#4\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citePpu}  [3]{\citePbullet\;\cite{#1} page~#2 \lcomdelim\url{#3}\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citePppu} [4]{\citePbullet\;\cite{#1} pages #2--#3 \lcomdelim\url{#4}\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citePpg}  [3]{\citePbullet\;\cite{#1} \href{http://books.google.com/books?vid=ISBN#3\&pg=PA#2}{page~#2}\index[xref]{{\cite{#1}}}} % citation with google book search link to page
\newcommand{\citePpgc} [4]{\citePbullet\;\cite{#1} \href{http://books.google.com/books?vid=ISBN#3\&pg=PA#2}{page~#2} \lcomdelim#4\rcomdelim\index[xref]{{\cite{#1}}}} % citation with google book search link to page
\newcommand{\citePg}   [2]{\citePbullet\;\href{http://books.google.com/books?vid=ISBN#2}{\cite{#1}}} % citation with google book search link to page
\newcommand{\citePgc}  [3]{\citePbullet\;\cite{#1} \href{http://books.google.com/books?vid=ISBN#2}{\lcomdelim#3\rcomdelim}\index[xref]{{\cite{#1}}}} % citation with google book search link to page
\newcommand{\citePppg} [4]{\citePbullet\;\cite{#1} \href{http://books.google.com/books?vid=ISBN#4\&pg=PA#2}{pages~#2--#3}\index[xref]{{\cite{#1}}}} % citation with google book search link to page
\newcommand{\citePppgc}[5]{\citePbullet\;\cite{#1} \href{http://books.google.com/books?vid=ISBN#4\&pg=PA#2}{pages~#2--#3} \lcomdelim#5\rcomdelim\index[xref]{{\cite{#1}}}} % citation with google book search link to page
%---------------------------------------
% incollection citations
%---------------------------------------
\newcommand{\citeIfull}[1]{\citeIbullet\;\fullcite{#1}\index[xref]{{\cite{#1}}}}          % citation table entry with only reference (no page number)
\newcommand{\citeI}    [1]{\citeIbullet\;\cite{#1}\index[xref]{{\cite{#1}}}}          % citation table entry with only reference (no page number)
\newcommand{\citeIp}   [2]{\citeIbullet\;\cite{#1} page~#2\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citeIps}  [2]{\citeIbullet\;\cite{#1} pages #2\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citeIpp}  [3]{\citeIbullet\;\cite{#1} pages #2--#3\index[xref]{{\cite{#1}}}} % citation table entry with ref and page range
\newcommand{\citeIc}   [2]{\citeIbullet\;\cite{#1} \lcomdelim#2\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one comment
\newcommand{\citeIu}   [2]{\citeIbullet\;\cite{#1} \lcomdelim\url{#2}\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one comment
\newcommand{\citeIuc}  [3]{\citeIbullet\;\cite{#1} \lcomdelim\url{#2}\rcomdelim \lcomdelim#3\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one comment
\newcommand{\citeIpc}  [3]{\citeIbullet\;\cite{#1} page~#2 \lcomdelim#3\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citeIppc} [4]{\citeIbullet\;\cite{#1} pages #2--#3 \lcomdelim#4\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citeIpu}  [3]{\citeIbullet\;\cite{#1} page~#2 \lcomdelim\url{#3}\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citeIppu} [4]{\citeIbullet\;\cite{#1} pages #2--#3 \lcomdelim\url{#4}\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citeIpg}  [3]{\citeIbullet\;\cite{#1}, \href{http://books.google.com/books?vid=ISBN#3\&pg=PA#2}{page~#2}\index[xref]{{\cite{#1}}}} % citation with google book search link to page
\newcommand{\citeIpgc} [4]{\citeIbullet\;\cite{#1}, \href{http://books.google.com/books?vid=ISBN#3\&pg=PA#2}{page~#2} \lcomdelim#4\rcomdelim\index[xref]{{\cite{#1}}}} % citation with google book search link to page
\newcommand{\citeIg}   [2]{\citeIbullet\;\href{http://books.google.com/books?vid=ISBN#2}{\cite{#1}}} % citation with google book search link to page
\newcommand{\citeIgc}  [3]{\citeIbullet\;\cite{#1}, \href{http://books.google.com/books?vid=ISBN#2}{\lcomdelim#3\rcomdelim}\index[xref]{{\cite{#1}}}} % citation with google book search link to page
\newcommand{\citeIppg} [4]{\citeIbullet\;\cite{#1}, \href{http://books.google.com/books?vid=ISBN#4\&pg=PA#2}{pages~#2--#3}\index[xref]{{\cite{#1}}}} % citation with google book search link to page
\newcommand{\citeIppgc}[5]{\citeIbullet\;\cite{#1}, \href{http://books.google.com/books?vid=ISBN#4\&pg=PA#2}{pages~#2--#3} \lcomdelim#5\rcomdelim\index[xref]{{\cite{#1}}}} % citation with google book search link to page
%---------------------------------------
% web citations
%---------------------------------------
\newcommand{\citeWfull}[1]{\citeWbullet\;\fullcite{#1}\index[xref]{{\cite{#1}}}}          % citation table entry with only reference (no page number)
\newcommand{\citeW}    [1]{\citeWbullet\;\cite{#1}\index[xref]{{\cite{#1}}}}          % citation table entry with only reference (no page number)
\newcommand{\citeWc}   [2]{\citeWbullet\;\cite{#1} \lcomdelim#2\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one comment
\newcommand{\citeWu}   [2]{\citeWbullet\;\cite{#1} \lcomdelim\url{#2}\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one comment
\newcommand{\citeWuc}  [3]{\citeWbullet\;\cite{#1} \lcomdelim\url{#2}\rcomdelim \lcomdelim#3\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one comment
%---------------------------------------
% Original source citation---deprecated
%---------------------------------------
\newcommand{\citor}    [1]{\citebullet\;\cite{#1}\index[xref]{{\cite{#1}}}}          % citation table entry with only reference (no page number)
\newcommand{\citorp}   [2]{\citebullet\;\cite{#1} page~#2\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citorpu}  [3]{\citebullet\;\cite{#1} \href{#3}{page~#2}\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citorpc}  [3]{\citebullet\;\cite{#1} page~#2 \lcomdelim#3\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citorpcu} [4]{\citebullet\;\cite{#1} \href{#4}{page~#2} \lcomdelim#3\rcomdelim\index[xref]{{\cite{#1}}}}%
\newcommand{\citorppcu}[5]{\citebullet\;\cite{#1} \href{#5}{pages~#2--#3}, #4\index[xref]{{\cite{#1}}}}%
\newcommand{\citorppc} [4]{\citebullet\;\cite{#1} pages #2--#3 \lcomdelim#4\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citorpp}  [3]{\citebullet\;\cite{#1} pages #2--#3\index[xref]{{\cite{#1}}}} % citation table entry with ref and page range
\newcommand{\citorc}   [2]{\citebullet\;\cite{#1} \lcomdelim#2\rcomdelim\index[xref]{{\cite{#1}}}} % citation table entry with ref and one comment
\newcommand{\citorpg}  [3]{\citebullet\;\cite{#1} \href{http://books.google.com/books?vid=ISBN#3\&pg=PA#2}{page~#2}\index[xref]{{\cite{#1}}}} % citation with google book search link to page
\newcommand{\citorpgc} [4]{\citebullet\;\cite{#1} \href{http://books.google.com/books?vid=ISBN#3\&pg=PA#2}{page~#2} \lcomdelim#4\rcomdelim\index[xref]{{\cite{#1}}}} % citation with google book search link to page
\newcommand{\citorppgc}[5]{\citebullet\;\cite{#1} \href{http://books.google.com/books?vid=ISBN#4\&pg=PA#2}{pages~#2--#3} \lcomdelim#5\rcomdelim\index[xref]{{\cite{#1}}}} % citation with google book search link to page
\newcommand{\citorppg} [4]{\citebullet\;\cite{#1} \href{http://books.google.com/books?vid=ISBN#4\&pg=PA#2}{pages~#2--#3}\index[xref]{{\cite{#1}}}} % citation with google book search link to page
\newcommand{\citorppu} [4]{\citebullet\;\cite{#1} \href{#4}{pages~#2--#3}\index[xref]{{\cite{#1}}}}
\newcommand{\citorcu}  [3]{\citebullet\;\cite{#1} \href{#3}{\lcomdelim#2\rcomdelim}\index[xref]{{\cite{#1}}}} 
%---------------------------------------
% Cite with web link to actual page being referenced
%---------------------------------------
\newcommand{\citercu}  [3]{\citebullet\;\cite{#1} \href{#3}{\lcomdelim#2\rcomdelim}\index[xref]{{\cite{#1}}}} 
%deprecated\newcommand{\citerpuc} [4]{\citebullet\;\cite{#1} \href{#3}{page~#2} \lcomdelim#4\rcomdelim\index[xref]{{\cite{#1}}}} 
\newcommand{\citerpu}  [3]{\citebullet\;\cite{#1} \href{#3}{page~#2}\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citerpcu} [4]{\citebullet\;\cite{#1} \href{#4}{page~#2} \lcomdelim#3\rcomdelim\index[xref]{{\cite{#1}}}}
\newcommand{\citerppu} [4]{\citebullet\;\cite{#1} \href{#4}{pages~#2--#3}\index[xref]{{\cite{#1}}}} % citation table entry with ref and one page
\newcommand{\citerpg}  [3]{\citebullet\;\cite{#1} \href{http://books.google.com/books?vid=ISBN#3\&pg=PA#2}{page~#2}\index[xref]{{\cite{#1}}}} % citation with google book search link to page
\newcommand{\citerpgc} [4]{\citebullet\;\cite{#1} \href{http://books.google.com/books?vid=ISBN#3\&pg=PA#2}{page~#2} \lcomdelim#4\rcomdelim\index[xref]{{\cite{#1}}}} % citation with google book search link to page
\newcommand{\citerg}   [2]{\citebullet\;\cite{#1} \lcomdelim ISBN:\href{http://books.google.com/books?vid=ISBN#2}{#2}\rcomdelim}
\newcommand{\citergc}  [3]{\citebullet\;\cite{#1} \href{http://books.google.com/books?vid=ISBN#2}{\lcomdelim#3\rcomdelim}\index[xref]{{\cite{#1}}}} % citation with google book search link to page
\newcommand{\citerppg} [4]{\citebullet\;\cite{#1} \href{http://books.google.com/books?vid=ISBN#4\&pg=PA#2}{pages~#2--#3}\index[xref]{{\cite{#1}}}} % citation with google book search link to page
\newcommand{\citerppgc}[5]{\citebullet\;\cite{#1} \href{http://books.google.com/books?vid=ISBN#4\&pg=PA#2}{pages~#2--#3} \lcomdelim#5\rcomdelim\index[xref]{{\cite{#1}}}} % citation with google book search link to page
\newcommand{\citeoeis} [1]{{\scs\citeWbullet}\;\href{http://oeis.org/#1}{\cite{oeis} \lcomdelim\url{http://oeis.org/#1}\rcomdelim}} % OEIS citation
\newcommand{\genbank}  [3]{{\scs\citeWbullet}\;\cite{genbank} \lcomdelim#1, #2, \url{#3}\rcomdelim} % 1=title, 2=NC number 3=url
\newcommand{\cittr}    [1]{\citetbl{\citebullet\;\cite{#1} \index[xref]{{\cite{#1}}}}} % citation with google book search link to page
\newcommand{\cittu}    [1]{\citetbl{\citebullet\;\url{#1}}}
\newcommand{\cittrc}   [2]{\citetbl{\citerc{#1}{#2}}}
\newcommand{\cittrpc}  [3]{\citetbl{\citerpc{#1}{#2}{#3}}}
\newcommand{\cittrp}   [2]{\citetbl{\citebullet\;\cite{#1} {page~#2}\index[xref]{{\cite{#1}}}}} % citation with google book search link to page
\newcommand{\cittrpp}  [3]{\citetbl{\citebullet\;\cite{#1} {pages~#2--#3}\index[xref]{{\cite{#1}}}}} % citation with google book search link to page
\newcommand{\cittrppc} [4]{\citetbl{\citerppc{#1}{#2}{#3}{#4}}}
\newcommand{\cittrcu}  [3]{\citetbl{\citebullet\;\cite{#1}, \href{#3}{#2}\index[xref]{{\cite{#1}}}}} 
\newcommand{\cittrpu}  [3]{\citetbl{\citebullet\;\cite{#1}, \href{#3}{page~#2}\index[xref]{{\cite{#1}}}}} % citation table entry with ref and one page
\newcommand{\cittrpcu} [4]{\citetbl{\citebullet\;\cite{#1}, \href{#4}{page~#2}, #3\index[xref]{{\cite{#1}}}}}
\newcommand{\cittrppu} [4]{\citetbl{\citebullet\;\cite{#1}, \href{#4}{pages~#2--#3}\index[xref]{{\cite{#1}}}}} % citation table entry with ref and one page
\newcommand{\cittrpg}  [3]{\citetbl{\citebullet\;\cite{#1}, \href{http://books.google.com/books?vid=ISBN#3\&pg=PA#2}{page~#2}\index[xref]{{\cite{#1}}}}} % citation with google book search link to page
\newcommand{\cittrpgc} [4]{\citetbl{\citebullet\;\cite{#1}, \href{http://books.google.com/books?vid=ISBN#3\&pg=PA#2}{page~#2}, #4\index[xref]{{\cite{#1}}}}} % citation with google book search link to page
\newcommand{\cittrg}   [2]{\cittr{#1}}%  
\newcommand{\cittrgc}  [3]{\citetbl{\citebullet\;\cite{#1}, \href{http://books.google.com/books?vid=ISBN#2\&pg=PA#2}{#3}\index[xref]{{\cite{#1}}}}} % citation with google book search link to page
\newcommand{\cittrppg} [4]{\citetbl{\citebullet\;\cite{#1}, \href{http://books.google.com/books?vid=ISBN#4\&pg=PA#2}{pages~#2--#3}\index[xref]{{\cite{#1}}}}} % citation with google book search link to page
\newcommand{\cittrppgc}[5]{\citetbl{\citebullet\;\cite{#1}, \href{http://books.google.com/books?vid=ISBN#4\&pg=PA#2}{pages~#2--#3}, #5\index[xref]{{\cite{#1}}}}} % citation with google book search link to page
\newcommand{\cithrpg}  [3]{\nocite{#1}\index[xref]{{\cite{#1}}}} % hidden citation table entry with ref and one page
\newcommand{\citepg}   [3]{\citetbl{\citebullet\;\cite{#1}, \href{http://books.google.com/books?vid=ISBN#3\&pg=PA#2}{page~#2}\index[xref]{{\cite{#1}}}}} % citation with google book search link to page
\newcommand{\citeppg}  [4]{\citetbl{\citebullet\;\cite{#1}, \href{http://books.google.com/books?vid=ISBN#4\&pg=PA#2}{pages~#2--#3}\index[xref]{{\cite{#1}}}}} % citation with google book search link to page
%---------------------------------------
% Hidden source citation
%---------------------------------------
\newcommand{\cithr}  [1]{\nocite{#1}\index[xref]{{\cite{#1}}}} % hidden citation table entry with only reference (no page number)
\newcommand{\cithrp} [2]{\nocite{#1}\index[xref]{{\cite{#1}}}} % hidden citation table entry with ref and one page
\newcommand{\cithrpp}[3]{\nocite{#1}\index[xref]{{\cite{#1}}}} % hidden citation table entry with ref and page range
\newcommand{\cithrc} [2]{\nocite{#1}\index[xref]{{\cite{#1}}}} % hidden citation table entry with ref and one comment
\newcommand{\citepp} [3]{\citetbl{\citerpp{#1}{#2}{#3}}}

%--------------------------------------
% attention markers
%--------------------------------------
\newcommand{\attention}[1][]{%
    \index{{\bf\em attention markers}!#1}
   %\index{{\bf\em \textcolor{red}{attention markers}}!#1}
   }
\newcommand{\improved}[0]{\attention[improved]}
\newcommand{\new}     [0]{\attention[new]}
\newcommand{\problem} [0]{\attention[problem]}
\newcommand{\noproof} [0]{\attention[no proof]}
\newcommand{\note} [0]{\attention[note]}

%--------------------------------------
% quote boxes
%--------------------------------------
\newcommand{\quotetext}[1]{{\fntquote{\quoteo}#1{\quotec}}}
\newcommand{\qboxnpq}[4][20mm]{% example: \qboxnpq[18mm]{name...}{image.jpg}{quote to the right of the image}
  \begin{center}%
    \shadowbox{\centering%
      \begin{minipage}{\textwidth-7mm}%
        \centering%
        \textimgl[#1]{#3}{\fntquote{\quoteo}#4{\quotec}}%
        \\\footnotesize#2%
      \end{minipage}%
      }%
  \end{center}%
  }

\newcommand{\qboxnps}[4][20mm]{% example: \qboxnpq[18mm]{name...}{image.jpg}{quote to the right of the image}
  \begin{center}%
    \shadowbox{\centering%
      \begin{minipage}{\textwidth-10mm}%
        \centering%
        \textimgl[#1]{#3}{%
          {\quoteo}{\fntquote#4}{\quotec}%
          \\\indentx\footnotesize#2%
          }%
      \end{minipage}%
      }%
  \end{center}%
  }

\newcommand{\textq}[1]{{\itshape``#1"}}% text for quotes

\newcommand{\qboxns}[2]{% name, short quote
  \begin{center}%
    \shadowbox{\parbox[b]{15\textwidth/16}{\center%
      \parbox[t]{14\textwidth/16}{\fntquote%
        \quoteo #2\quotec\normalfont%
       \\[1ex]\normalfont\footnotesize #1%
       }%
    }}%
  \end{center}%
  }%

\newcommand{\qboxnpqt}[5][20mm]{% example: \qboxnpqt[25mm]{name}{img.jpg}{text left}{text right}
  \begin{center}%
    \shadowbox{\centering%
      \begin{minipage}{\textwidth-10mm}\centering%
        \textimgtext[#1]{#3}{\fntquote\quoteo#4\quotec}{\fntquote\quoteo#5\quotec}%
        \\\footnotesize#2%
      \end{minipage}%
      }%
  \end{center}%
  }%

\newcommand{\qboxnpqz}[5][15mm]{%quote box: name, picture, quote, Chinese translation
  %\begin{center}%
    \shadowbox{
      \begin{tabular}{m{7\tw/16-#1/2-3\tabcolsep}m{#1}m{9\tw/16-#1/2-3\tabcolsep}}
        \fntquote%
        \quoteo #4\quotec%
        &%
        \includegraphics*[width=#1,keepaspectratio=true]{#3}%
        &%
        \raggedright\zhtzye
        \quoteo #5\quotec%
        \tabularnewline
        \mc{3}{c}{\normalfont\footnotesize #2}
      \end{tabular}
      }%
  %\end{center}%
  }%

%name quote translation quote-box
\newcommand{\qboxnqt}[3]{{%
  \centering%
  \shadowbox{\begin{minipage}{\tw-5mm}%
    \begin{minipage}{\tw/2-8mm}%
      \centering%
      \fntquote%
      \quoteo{#2}\quotec%
    \end{minipage}%
    \hspace{5mm}%
    \begin{minipage}{\tw/2-8mm}%
      \centering%
      \fntquote%
      \quoteo{#3}\quotec%
    \end{minipage}%
    \\[1ex]%
    \normalfont%
    \footnotesize%
    #1%
  \end{minipage}}% end shadow box
  }}%

%name quote quote-box
\newcommand{\qboxnq}[2]{%
  \begin{center}%
    \shadowbox{\parbox[b]{15\textwidth/16}{\center%
      \parbox[t]{15\textwidth/16}{\fntquote%
        \quoteo #2\quotec%
        }%
      \\[1ex]\normalfont\footnotesize #1%
    }}%
  \end{center}%
  }%

%--------------------------------------
% Renew Commands
%--------------------------------------
\renewcommand{\baselinestretch}{1}
%\renewcommand{\arraystretch}{1.5}

%--------------------------------------
% Font environments
%--------------------------------------
\newenvironment{personal}{\fnthw\color{handwriting}}{\normalcolor\normalfont}%

%--------------------------------------
% Environments
%--------------------------------------
\newenvironment{fsJ}{\begin{tiny}        }{ \end{tiny}          }
\newenvironment{fsK}{\begin{scriptsize}  }{ \end{scriptsize}    }
\newenvironment{fsL}{\begin{footnotesize}}{ \end{footnotesize}  }
\newenvironment{fsM}{\begin{small}       }{ \end{small}         }
\newenvironment{fsN}{\begin{normalsize}  }{ \end{normalsize}    }
\newenvironment{fsO}{\begin{large}       }{ \end{large}         }
\newenvironment{fsP}{\begin{Large}       }{ \end{Large}         }
\newenvironment{fsQ}{\begin{LARGE}       }{ \end{LARGE}         }
\newenvironment{fsR}{\begin{huge}        }{ \end{huge}          }
\newenvironment{fsS}{\begin{Huge}        }{ \end{Huge}          }

\newenvironment{liste}[1][\imark]
  {\begin{list}{#1}{
      \setlength{\topsep        }{0ex}
      \setlength{\partopsep     }{0ex}
      \setlength{\parsep        }{0ex}
      \setlength{\itemsep       }{0ex}
      \setlength{\leftmargin    }{4ex}
      \setlength{\rightmargin   }{4ex}
      \setlength{\listparindent }{0ex}
      \setlength{\labelwidth    }{1ex}
      \setlength{\labelsep      }{1ex}
      \setlength{\itemindent    }{0ex}
      }}
   {\end{list}}

\newenvironment{listi}[1][\imarks]%list for indexes
  {\begin{list}{#1}{
      \setlength{\topsep        }{0ex}
      \setlength{\partopsep     }{0ex}
      \setlength{\parsep        }{0ex}
      \setlength{\itemsep       }{0ex}
      \setlength{\leftmargin    }{4ex}
      \setlength{\rightmargin   }{4ex}
      \setlength{\listparindent }{0ex}
      \setlength{\labelwidth    }{5ex}
      \setlength{\labelsep      }{0ex}
      \setlength{\itemindent    }{0ex}
      }}
   {\end{list}}


\newcounter{enume_cntr}
\newenvironment{enume}
   {\begin{list}{\arabic{enume_cntr}. }{
      \usecounter{enume_cntr}
      \setlength{\topsep        }{0ex}
      \setlength{\partopsep     }{0ex}
      \setlength{\parsep        }{0ex}
      \setlength{\itemsep       }{0ex}
      \setlength{\leftmargin    }{4ex}
      \setlength{\rightmargin   }{4ex}
      \setlength{\listparindent }{0ex}
      \setlength{\labelwidth    }{5ex}
      \setlength{\labelsep      }{0ex}
      \setlength{\itemindent    }{0ex}
      }}
   {\end{list}}

\newenvironment{survey}%literature survey
  {
    %\begin{sffamily}       % use sans-serif font (no serif)
    %\PaperPortrait
    \books
    {\bfseries\scshape\footnotesize\hspace{1ex} Literature survey: }
    \begin{footnotesize}   % change font size
   %\begin{changebar}      % start change bar environment -- gave PS problem
  }
  {
   %\end{changebar}        % end change bar environment
    \end{footnotesize}     % end new font size
    \hfill\books
    %\hfill \PaperPortrait
    %\end{sffamily}         % end sans-serif font
  }

\renewenvironment{theindex}
  {
    %\begin{multicols}{2}
    \normalfont
    %\begin{rmfamily}       % use sans-serif font (no serif)
    \begin{footnotesize}   % change font size
    \begin{listi}[]
    %\item default test \sffamily test sffamily \rmfamily test rmfamily
  }
  {
    \end{listi}
    \end{footnotesize}     % end new font size
    %\end{rmfamily}         % end sans-serif font
  }

%=======================================
% Graphics Support
%=======================================
\newcommand{\textpr}[3][20mm]{%
  {\begin{minipage}[c]{\tw-#1-9mm} #2 \end{minipage}}\hfill%
  {\begin{minipage}[c]{#1}{\hbox{\includegraphics*[width=#1,height=#1,keepaspectratio=true]{#3}}}\end{minipage}}%
  }%

\newcommand{\textpl}[3][20mm]{%
  {\begin{minipage}[c]{#1}{\hbox{\includegraphics*[width=#1,height=#1,keepaspectratio=true]{#3}}}\end{minipage}}\hfill%
  {\begin{minipage}[c]{\tw-#1-9mm} #2 \end{minipage}}%
  }%

\newcommand{\textimgl}[3][30mm]{{\setlength{\parindent}{0mm}% usage example: \textimgl[15mm]{image.jpg}{Here is some text with image on the left}
  {\begin{minipage}[c]{#1}{\includegraphics*[width=#1,keepaspectratio=true]{#2}}\end{minipage}}\hspace{3.8mm}%
  {\begin{minipage}[c]{\tw-#1-4mm}#3\end{minipage}}  %\\[0.625ex]%
  }}%

\newcommand{\textimgr}[3][30mm]{{\setlength{\parindent}{0mm}% usage example: \textimgl[15mm]{image.jpg}{Here is some text with image on the right}
  {\begin{minipage}[c]{\tw-#1-4mm}#3\end{minipage}}\hspace{3.8mm}%
  {\begin{minipage}[c]{#1}{\hbox{\includegraphics*[width=#1,keepaspectratio=true]{#2}}}\end{minipage}}\\[0.625ex]%
  }}%

\newcommand{\textimgrt}[3][30mm]{% usage example: \textimgl[15mm]{image.jpg}{Here is some text with image on the right}
  \begin{tabular}{lm{#1}}
    \begin{tabular}{l}#3\end{tabular}%
    &\includegraphics*[width=#1,keepaspectratio=true]{#2}%
  \end{tabular}}%

\newcommand{\textimglr}[4][30mm]{{\setlength{\parindent}{0mm}% usage example: \textimgl[15mm]{left image.jpg}{right image.jpg}{text inbetween two images}
  {\begin{minipage}[c]{#1}{\hbox{\includegraphics*[width=#1,keepaspectratio=true]{#2}}}\end{minipage}}\hspace{3.8mm}%
  {\begin{minipage}[c]{\tw-#1-#1-10mm}#4\end{minipage}}\hspace{3.8mm}%
  {\begin{minipage}[c]{#1}{\hbox{\includegraphics*[width=#1,keepaspectratio=true]{#3}}}\end{minipage}}\\[0.625ex]%
  }}%

\newcommand{\textimgtext}[4][20mm]{% usage example: \textimgl[15mm]{imageLeft.jpg}{text to left of image}{text to right of image}
  {\begin{minipage}[c]{(\tw-#1-11mm)/2}#3\end{minipage}}\hspace{3.8mm}%
  {\begin{minipage}[c]{#1}{\includegraphics*[width=#1,keepaspectratio=true]{#2}}\end{minipage}}\hspace{3.8mm}%
  {\begin{minipage}[c]{(\tw-#1-11mm)/2}#4\end{minipage}}%
  }%

\newcommand{\ingr}[3]{%include graphic
  \includegraphics*[width=#1,height=#2,keepaspectratio=true]{#3}%
  }%
\newcommand{\ingrreflect}[3]{%include graphic
  \reflectbox{\includegraphics*[width=#1,height=#2,keepaspectratio=true]{#3}}%
  }%
\newcommand{\rgraphic}[4][0pt]{%raise graphic
  \raisebox{#1}{\includegraphics*[width=#2,height=#3,keepaspectratio=true]{#4}}%
  }%
\newcommand{\rrgraphic}[4][0pt]{%raise and reflect graphic
  \raisebox{#1}{\reflectbox{\includegraphics*[width=#2,height=#3,keepaspectratio=true]{#4}}}%
  }%
\newcommand{\rographic}[4][90]{%rotate graphic
  \rotatebox{#1}{\includegraphics*[width=#2,height=#3,keepaspectratio=true]{#4}}%
  }%
\newcommand{\rographicfm}[4][90]{%rotate graphic with footnotemark
  \rotatebox{#1}{\includegraphics*[width=#2,height=#3,keepaspectratio=true]{#4}}\footnotemark%
  }%
\newcommand{\rgraphicb}[4][0pt]{%raise graphic in a box
  {\raisebox{#1}{{\parbox[c][#3][c]{#2}{\includegraphics*[width=#2,height=#3,keepaspectratio=true]{#4}}}}}%
  }
\newcommand{\imgwh}[3]{%
  {{{\includegraphics*[width=#1,height=#2,keepaspectratio=true]{#3}}}}%
  }
\newcommand{\sfile}[2]{%1:size 2:picture filename
  \resizebox{#1}{!}{\input{#2}}%
  }%
\newcommand{\srffile}[2]{%1:size 2:picture filename, reflect
  \reflectbox{\resizebox{#1}{!}{\input{#2}}}%
  }%
\newcommand{\srfile}[3]{%1:size 2:raise height 3:picture filename
  \raisebox{#2}{\resizebox{#1}{!}{\input{#3}}}%
  }%
\newcommand{\srotfile}[3]{%1:size 2: rotation in degrees 3:picture filename
  \rotatebox{#2}{\resizebox{#1}{!}{\input{#3}}}%
  }%

%=======================================
% More Graphics Support
%=======================================
           %\cnodeput {0}(-1, 0){add11}{$+$}\cnodeput{0}( 1, 0){add12}{$+$}%%
%\newcommand{\fnodeput}[4]{\rput{#1}{#2}{\fnode(0,0){#3}{#4}}}%
%\newcommand{\fnodeput}[4]{%similar parameter definition to \cnodeput but for frames
%  \fnode{#2}{#3}%          put a frame node at #2=(x,y) with label #3
%  \rput{#1}(0,0){#4}%      put object #4 inside the node with rotation #1
%  }%
% #1=rotation (#2,#3)=(x,y) #4=label #5=contents 
\newcommand{\fnodeput}[5]{%similar parameter definition to \cnodeput but for frames
  \fnode(#2,#3){#4}%          put a frame node at #2=(x,y) with label #3
  \rput{#1}(#2,#3){#5}%      put object #4 inside the node with rotation #1
  }%
\newcommand{\nnode}[3]{%put a node connection
  \Cnode*[radius=1pt](#1,#2){#3}%
  }%
\newcommand{\triLnodeput}[6][7.5mm]{%triangle pointing left
  \rput{#2}(#3,#4){\trinode[trimode=L,framesize=#1]{#5}{#6}}%          put a frame node at #2=(x,y) with label #3
  }%
\newcommand{\triRnodeput}[6][7.5mm]{%triangle pointing right
  \rput{#2}(#3,#4){\trinode[trimode=R,framesize=#1]{#5}{#6}}%          put a frame node at #2=(x,y) with label #3
  }%
\newcommand{\pzzero}[1]{\pscircle[linecolor=zero,linewidth=1pt](#1){1mm}}% a zero in a pole-zero plot
\newcommand{\pzpole}[1]{\rput(#1){%a pole in a pole-zero plot at location () defined by \pnode commmand
  \psline[linecolor=pole,linewidth=1pt]{cc-cc}(-0.75mm,-0.75mm)( 0.75mm,0.75mm)% rising-slope  line of "x"
  \psline[linecolor=pole,linewidth=1pt]{cc-cc}( 0.75mm,-0.75mm)(-0.75mm,0.75mm)% falling-slope line of "x"
  }}% 


%--------------------------------------
% cell color support
%--------------------------------------
\newcommand{\ccc}{\cellcolor{cyan}}
\newcommand{\ccg}{\cellcolor{lgray}}
\newcommand{\ccy}{\cellcolor{yellow}}


%2015aug17%%--------------------------------------
%2015aug17%% Picture boxes
%2015aug17%%--------------------------------------
%2015aug17%\setlength{\unitlength}{0.03mm}
%2015aug17%\newbox {\robotBoyR}
%2015aug17%\savebox{\robotBoyR}{
%2015aug17%\color[rgb]{1   ,0   ,0}
%2015aug17%  \begin{picture}(150,325)(0,0)
%2015aug17%  \put( 0, 0 ){
%2015aug17%    \multiput(10,275)(5,0){17}{\line(0,1){30}}               % hair
%2015aug17%    \put(  0,175){\framebox(100,100)}                        % head
%2015aug17%    \put( 75,250){\circle{20}}                               % eye outer
%2015aug17%    \put( 80,250){\circle*{10}}                              % eye pupil
%2015aug17%    \put( 75,200){\circle{20}}                               % mouth
%2015aug17%    \multiput(30,150)(0,5){5}{\line(1,0){40}}                % neck
%2015aug17%    \put(  0, 50){\framebox(100,100){}}                      % torso
%2015aug17%    \multiput(60,140)(5,0){15}{\line(0,-1){30}}              % arm
%2015aug17%    \multiput(10,0)(0,5){10}{\line(1,0){30}}                 % leg
%2015aug17%    \multiput(60,0)(0,5){10}{\line(1,0){30}}                 % leg
%2015aug17%  }
%2015aug17%  \end{picture}
%2015aug17%}
%2015aug17%
%2015aug17%\newbox {\robotBoyL}
%2015aug17%\savebox{\robotBoyL}{
%2015aug17%\color[rgb]{1,0,0}
%2015aug17%  \begin{picture}(150,325)(0,0)
%2015aug17%  \put( 0, 0 ){
%2015aug17%    \multiput(10,275)(5,0){17}{\line(0,1){30}}               % hair
%2015aug17%    \put(  0,175){\framebox(100,100)}                        % head
%2015aug17%    \put( 25,250){\circle{20}}                               % eye outer
%2015aug17%    \put( 20,250){\circle*{10}}                              % eye pupil
%2015aug17%    \put( 25,200){\circle{20}}                               % mouth
%2015aug17%    \multiput(30,150)(0,5){5}{\line(1,0){40}}                % neck
%2015aug17%    \put(  0, 50){\framebox(100,100){}}                      % torso
%2015aug17%    \multiput(40,140)(-5,0){15}{\line(0,-1){30}}            % arm
%2015aug17%    \put( 25,25){\circle{40}}                                % leg
%2015aug17%    \put( 75,25){\circle{40}}                                % leg
%2015aug17%  }
%2015aug17%  \end{picture}
%2015aug17%}
%2015aug17%
%2015aug17%\newbox{\robotGirlL}
%2015aug17%\savebox{\robotGirlL}{
%2015aug17%\color[rgb]{1 ,0 ,0}
%2015aug17%  \begin{picture}(150,325)(0,0)
%2015aug17%  \put( 0, 0 ){
%2015aug17%    \put(-10,280){\line(1,0){155}}                             % hair very top
%2015aug17%    \multiput(-10,260)(0,5){4}{\line(1,0){110}}                % hair top
%2015aug17%    \multiput(100,280)(5,0){10}{\line(0,-1){200}}            % hair back
%2015aug17%    \put(  0,175){\framebox(100,80)}                         % head
%2015aug17%    \put( 25,240){\circle{20}}                               % eye outer
%2015aug17%    \put( 20,240){\circle*{10}}                              % eye pupil
%2015aug17%    \put( 25,190){\circle{20}}                               % mouth
%2015aug17%    \multiput(30,150)(0,5){5}{\line(1,0){40}}                % neck
%2015aug17%    \put(30,150){\line(-1,-4){25}}                           % dress left
%2015aug17%    \put(70,150){\line( 1,-4){25}}                           % dress right
%2015aug17%    \put( 5, 50){\line( 1, 0){90}}                           % dress bottom
%2015aug17%    \multiput(40,125)(-14,0){6}{\circle{25}}                 % arm
%2015aug17%    \multiput(40,20)(0,5){6}{\line(1,0){20}}                 % leg
%2015aug17%    \put( 50,10){\circle{20}}                                % foot
%2015aug17%  }
%2015aug17%  \end{picture}
%2015aug17%}
%2015aug17%
%2015aug17%
%=======================================
% Picture boxes
%=======================================
\newcommand{\farraybox}[1]{% framed array box
  \arrayrulecolor{picbox}%
  \begin{array}{|c|}%
    \hline \hspace{1pt}\vspace{1mm}%
      #1%
    \\\hline%
  \end{array}%
  }%

\newcommand{\ononepage}[2][\textwidth]{{\setlength{\parindent}{0ex}\begin{minipage}{#1}#2\end{minipage}}}
\newenvironment{boxedminipage}[3][]{\begin{minipage}[#1]{#2}#3}{\end{minipage}}

%==========================================================
% banner
%==========================================================
\newcommand{\banner}[3][blue]{%
  {\raggedleft%
  \begin{tabular}{m{\tw-4.5mm}}%
    \cellcolor{blue}\color{white}\scshape\textbf{\mpcnt #2} \ifthenelse{\isempty{#3}}{}{\fntzht\bfseries{}}\dashrulefill[-1.1mm]{1mm 1mm}{1em}%
    \colorbox{white}{\includegraphics[height=2mm]{../common/graphics/watercraft/ghind_djg_blue.eps}}%
  \end{tabular}\newline%
  }}%

%==========================================================
% blanks
%==========================================================
\newboolean{showSolution}
\newlength{\length}
\newlength{\lengtha}
\newlength{\lengthb}
\newcommand{\bso}[2][]{\blanksol[#1]{#2}}% blank with solution
\newcommand{\bsox}[2][]{\blank[#1]}% blank with extraneous (extra) unused paramter
\newcommand{\blanksol}[2][]{% blank with solution
  \ifthenelse{\isempty{#1}}{\settowidth{\length}{#2#2}}{\setlength{\length}{#1}}
  \ifthenelse{\boolean{showSolution}}%
    {\underline{\parbox[l][1em][c]{\length}{\centering\textcolor{blue}{#2}}}}%
    {\underline{\parbox[l][1em][c]{\length}{\hspace{1ex}}}}%
  }
\newcommand{\bsoAo}[2][]{\cntreset\refstepcounter{cntr}\blankopt[#1]{\Alph{cntr}}{#2}}%blank with ABC counter set to A
\newcommand{\bsoA} [2][]{\refstepcounter{cntr}\blankopt[#1]{\Alph{cntr}}{#2}}%blank with ABC counter

\newcommand{\bss}[2][30mm]{\blanksso[#1]{#2}}% blank with shown solution
\newcommand{\blanksso}[2][30mm]{% blank with shown solution
  \underline{\parbox[l][1em][c]{#1}{\centering\color{blue}#2}}%
  \index{#2}
  }

\newcommand{\blank}   [1][10mm]{\underline{\hspace{#1}}}% blank line
\newcommand{\bhint}   [2][]{\blankopt[#1]{#2}{}}%blank with hint
\newcommand{\bzyhint} [2][]{\blankopt[#1]{{\fntzhr#2}}{}}%blank with hint in Chinese with bopomofo
\newcommand{\bcopy}   [2][]{\blankopt[#1]{#2}{#2}}%blank with what to copy
\newcommand{\bhintx}  [3][]{\blankopt[#1]{#2}{}}%blank with hint and extraneous (unused) parameter (used for making writing exercises from listening exercises
\newcommand{\bop}     [3][]{\blankopt[#1]{#2}{#3}}%blank with options and hidden solution
\newcommand{\bops}[3][]{\blankops[#1]{#2}{#3}}%blank with options and shown solution
\newcommand{\blankopt}[3][]%blank with options and solution
  {%
    \ifthenelse{\not\isempty{#2}}{\settowidth{\lengtha}{#2#2}}{\settowidth{\lengtha}{1em}}%
    \ifthenelse{\not\isempty{#3}}{\settowidth{\lengthb}{#3#3}}{\settowidth{\lengthb}{1em}}%
    \ifthenelse{\not\isempty{#1}}%
      {\setlength{\length}{#1}}%
      {\ifthenelse{\isempty{#3}}%
        {\settowidth{\length}{#2#2}}%
        {\settowidth{\length}{#3#3}}%
      }%
    \renewcommand{\arraystretch}{0.5}%
    \begin{tabular}[t]{@{}c@{}}%
      \blanksol[\length]{#3}%
      \\%
      \scriptsize\textcolor{blue}{#2}%
    \end{tabular}%
    \renewcommand{\arraystretch}{1}%
  }%

\newcommand{\blankp}[3][2em]{%phonics blank with options and solution
  \renewcommand{\arraystretch}{0.5}
  \begin{tabular}[t]{@{}c@{}}%
    \blanksol[#1]{\fntipa#3}%
    \\%
    \scriptsize\textcolor{blue}{\fntipa#2}%
  \end{tabular}%
  \renewcommand{\arraystretch}{1}
  }%

\newcommand{\blankops}[3][30mm]{%blank with options and solution
  \renewcommand{\arraystretch}{0.5}
  \begin{tabular}[t]{@{}c@{}}%
    \blanksso[#1]{#3}%
    \\%
    %\scriptsize\textcolor{blue}{#2}%
    \scriptsize#2%
  \end{tabular}%
  \renewcommand{\arraystretch}{1}
  }%

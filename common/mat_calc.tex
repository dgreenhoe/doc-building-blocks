%============================================================================
% LaTeX File
% Daniel J. Greenhoe
%============================================================================

%--------------------------------------
\chapter{Matrix Calculus}
\label{app:mc}
\index{matrix calculus}
%--------------------------------------
%\paragraph{Key results:}
%\formbox{\begin{array}{rcl@{\qquad}D@{\qquad}DD}
%     \pderiv{}{\vx}{\left(A\vx\right)}          &=& A^T   
%     &
%     & \pref{thm:mc_Ax} & \prefpo{thm:mc_Ax}
%  \\ \pderiv{}{\vx}{\left(\vx^T B\right)}       &=& B     
%     & 
%     & \pref{thm:mc_Ax} & \prefpo{thm:mc_Ax}
%  \\ \pderiv{}{\vx}{\left( \vx^T A \vx \right)} &=& A \vx  + A^T \vx 
%     & (quadratic form)
%     & \pref{thm:mc_xAx} & \prefpo{thm:mc_xAx}
%  \\ \pderiv{}{\vx}{(\vx ^T\vx )}               &=& 2\vx  
%     & (quadratic form, $\opA=\opI$)
%     & \pref{thm:mc_xAx} & \prefpo{thm:mc_xAx}
%  \\ \pderiv{}{\vx}\vz^T\vy &=& \pderiv{\vz}{\vx} \vy + \pderiv{\vy}{\vx} \vz 
%     & (product rule)
%     & \pref{thm:mc_product_rule} & \prefpo{thm:mc_product_rule}
%  \\ \pderiv{\vz}{\vx} &=& \pderiv{\vy}{\vx} \pderiv{\vz}{\vy}
%     & (chain rule)
%     & \pref{thm:mc_chain_rule} & \prefpo{thm:mc_chain_rule}
%\end{array}}

Optimization problems often require finding the value of some parameter
which results in some measure reaching a minimum or maximum value.
Often this optimal parameter value can be found by 
solving the single equation generated by the 
partial derivative of the measure with respect to the parameter.
When there are several parameters, 
optimization often requires several simultaneous equations
generated by the
partial derivatives of the measure with respect to each parameter.
The need for several partial derivatives and several simultaneous
equations leads to a natual union of two branches of mathematics---
partial differential equations and linear algebra.
In general, we would like to not only be able to take the partial 
derivative of a scalar with respect to another scalar,
but to be able to take the partial derivative of a vector 
with respect to another vector.
This generalization is the problem addressed in this section.
Other references are also available.%
\footnote{
  \citerc{graham}{Chapter 4},
  \citerc{haykin2001}{Appendix B},
  \citerc{moon2000}{Appendix E},  
  \citerpp{scharf}{274}{276},        
  \citerc{vantrees4}{Section A.7},
  \citer{felippa} 
  }

%=======================================
\section{First derivative of a vector with respect to a vector}
%=======================================
%--------------------------------------
\begin{definition}
\label{def:mc_x}
%\footnote{\url{http://en.wikipedia.org/wiki/Jacobian}}
%--------------------------------------
\defbox{\begin{array}{ll >{\ds}rc>{\ds}l @{\qquad}D}
  \mc{6}{l}{\text{$\vx$ is a vector with the following properties:}}
  \\
  &1. & \vx &\eqd&
         \left[
            \begin{array}{c}
               x_1 \\
               x_2 \\
               \vdots \\
               x_n
            \end{array}
         \right]
     & ($n$ element column vector)
  \\
  &2. & \pderiv{}{x_k} x_j &=& \kdelta_{kj}
      & ($\seqn{x_1,x_2,\ldots,x_n}$ are mutually independent)
\end{array}}
\end{definition}

%--------------------------------------
\begin{definition}[Jacobian matrix]
\footnote{
  \citerp{graham}{52},
  \citerp{scharf}{274},
  \citerp{vantrees4}{1398}
  }
\label{def:grad}
\index{Jacobian matrix}
%--------------------------------------
The \hid{gradient of $\vy$ with respect to $\vx$}, as well as
the \hid{gradient of $\vy^T$ with respect to $\vx$}, 
is defined as
\defbox{
  \pderiv{\vy}{\vx}   \eqd
  \pderiv{\vy^T}{\vx} \eqd
  \mcom{
  \renewcommand{\arraystretch}{2}
  \left[\begin{array}{*{4}{>{\ds}c}}
    \pderiv{y_1}{x_1} & \pderiv{y_2}{x_1} & \cdots & \pderiv{y_m}{x_1} \\
    \pderiv{y_1}{x_2} & \pderiv{y_2}{x_2} & \cdots & \pderiv{y_m}{x_2} \\
    \vdots            & \vdots            & \ddots & \vdots            \\
    \pderiv{y_1}{x_n} & \pderiv{y_2}{x_n} & \cdots & \pderiv{y_m}{x_n}
  \end{array}\right]
  }{$n\times m$ matrix}
  \qquad\qquad
  \forall \vy\in\vCm
  }
\end{definition}

%---------------------------------------
\begin{remark}
%---------------------------------------
Depending on whether $\vx$ and $\vy$ are scalars or vectors, 
$\pderiv{\vy}{\vx}$ takes on the following 
forms:\footnote{%
  For the generalization of the partial derivative of a matrix
  with respect to a matrix, see
  \citerc{graham}{chapter 6}.
  Graham uses \hie{kronecker products} to handle the additional dimensions(?)
  \index{kronecker product}
  }
\[
%\renewcommand{\arraystretch}{2}
\begin{array}{|c||c|c|}
   \hline
         & \text{$y$ scalar} & \text{$y$ vector} 
   \\
   \hline
   \hline
   \text{$x$ scalar}
   &
   \pderiv{y}{x}
   &
   \pderiv{\vy}{x} = 
   \left[\begin{array}{*{4}{c}}
         \pderiv{y_1}{x} & \pderiv{y_2}{x} & \cdots & \pderiv{y_m}{x} 
      \end{array}\right]
   \\ \hline
   \text{$x$ vector}
   &
   \pderiv{y}{\vx }= 
   \left[\begin{array}{c}
         \pderiv{y}{x_1} \\
         \pderiv{y}{x_2} \\
         \vdots          \\
         \pderiv{y}{x_n}
      \end{array}\right]
   &
   \pderiv{\vy}{\vx} \eqd
   \left[\begin{array}{ccccc}
         \pderiv{y_1}{x_1} & \pderiv{y_2}{x_1} & \cdots & \pderiv{y_m}{x_1} \\
         \pderiv{y_1}{x_2} & \pderiv{y_2}{x_2} & \cdots & \pderiv{y_m}{x_2} \\
         \vdots            & \vdots            & \ddots & \vdots            \\
         \pderiv{y_1}{x_n} & \pderiv{y_2}{x_n} & \cdots & \pderiv{y_m}{x_n}
      \end{array}\right]
   \\
   \hline
  \end{array}
\]
\end{remark}


%--------------------------------------
\begin{lemma}
\label{lem:mc_pxx}
%--------------------------------------
Let $\vx\in\vRn$ be a vector. Then
\lembox{\begin{array}{rclcl}
  \pderiv{}{x_k}x_i x_j 
    &=& \kdelta_{ik}x_j + \kdelta_{jk}x_i
    &=&
    \left\{\renewcommand{\arraystretch}{1.25}
       \begin{tabular}{cl}
          $2x_k$   & for $i=j=k$ \\
          $x_j$    & for $i=k$ and $j\ne k$ \\
          $x_i$    & for $i\neq k$ and $j=k$ \\
          $0$      & otherwise
       \end{tabular}
    \right.
  \end{array}}
\end{lemma}


%--------------------------------------
\begin{lemma}
\label{lem:xAx}
%--------------------------------------
\lembox{
   \left( \vx ^H \opA \vx  \right)
   = 
   \sum\limits_{i=1}^n \sum\limits_{j=1}^n
   a_{ij}x_i^\ast x_j
   \qquad\qquad\scriptstyle
   \forall \mcom{\scriptstyle\opA\in(\vCn\times\vCn)}{$n\times n$ array}
   \text{ and }
   \mcoml{\scriptstyle\vx \in \vCn}{$n$ element column vector}
  }
\end{lemma}

\begin{proof}
\begin{align*}
   \vx ^H \opA \vx 
   &\eqd
   \left[ \begin{array}{ccccc} x_1 & x_2 & \cdots & x_n \end{array} \right]^\ast
   \left[\begin{array}{ccccc}
     a_{11}   & a_{12}   & \cdots & a_{1n}   \\
     a_{21}   & a_{22}   & \cdots & a_{2n}   \\
     \vdots   & \vdots   & \ddots & \vdots \\
     a_{n1}   & a_{n2}   & \cdots & a_{nn}
   \end{array}\right]
   \left[
      \begin{array}{ccccc}
         x_1 \\
         x_2 \\
         \vdots            \\
         x_n
      \end{array}
   \right]
  && \text{by definitions of $\opA$ and $\vx$}
\\&=
   \left[ \begin{array}{ccccc} x_1 & x_2 & \cdots & x_n \end{array} \right]^\ast
   \sum\limits_{i=1}^n
   x_i
   \left[
      \begin{array}{ccccc}
         a_{1i}   \\
         a_{2i}   \\
         \vdots   \\
         a_{ni}   \\
      \end{array}
   \right]
 \\&=
   \sum\limits_{i=1}^n
   x_i
   \left[ \begin{array}{ccccc} x_1 & x_2 & \cdots & x_n \end{array} \right]^\ast
   \left[
      \begin{array}{ccccc}
         a_{1i}   \\
         a_{2i}   \\
         \vdots   \\
         a_{ni}   \\
      \end{array}
   \right]
\\&=
   \sum\limits_{i=1}^n
   x_i
   \sum\limits_{j=1}^n a_{ji}x_j^\ast
\\&=
   \sum\limits_{i=1}^n
   \sum\limits_{j=1}^n a_{ij}x_i^\ast x_j
\end{align*}
\end{proof}


%--------------------------------------
\begin{lemma}
\label{lem:mc_ab}
\index{product rule}
%--------------------------------------
\lembox{
  \pderiv{}{\vx} \brs{\fa(\vx)\,\fb(\vx)} 
    = \fa(\vx)\brs{\pderiv{}{\vx}\fb(\vx)} + \brs{\pderiv{}{\vx}\fa(\vx)}\fb(\vx)
  \qquad\qquad
  \mcoml{\forall \fa,\fb:\vRn\to\R }{$\fa(\vx),\fb(\vx)$ are functions from a vector $\vx$ to a scalar in $\R$}
  }
\end{lemma}
\begin{proof}
\begin{align*}
  \pderiv{}{\vx} \brs{\fa(\vx)\,\fb(\vx)} 
    &= \left[\begin{array}{l}
         \pderiv{}{x_1}\brs{\fa(\vx)\,\fb(\vx)}   \\
         \pderiv{}{x_2}\brs{\fa(\vx)\,\fb(\vx)}   \\
         \vdots                                   \\
         \pderiv{}{x_n}\brs{\fa(\vx)\,\fb(\vx)}  
       \end{array}\right]
  \\&= \left[\begin{array}{l}
         \fa(\vx)\,\pderiv{\fb(\vx)}{x_1} + \fb(\vx)\,\pderiv{\fa(\vx)}{x_1}     \\
         \fa(\vx)\,\pderiv{\fb(\vx)}{x_2} + \fb(\vx)\,\pderiv{\fa(\vx)}{x_2}     \\
         \\ \vdots                                \\                              
         \fa(\vx)\,\pderiv{\fb(\vx)}{x_n} + \fb(\vx)\,\pderiv{\fa(\vx)}{x_n}     
       \end{array}\right]
  \\&= \left[\begin{array}{l}
         \fa(\vx)\,\pderiv{\fb(\vx)}{x_1}  \\
         \fa(\vx)\,\pderiv{\fb(\vx)}{x_2}  \\
         \\                          
         \fa(\vx)\,\pderiv{\fb(\vx)}{x_n}  
       \end{array}\right]
     + \left[\begin{array}{l}
         \pderiv{\fa(\vx)}{x_1} \fb(\vx) \\
         \pderiv{\fa(\vx)}{x_2} \fb(\vx) \\
         \vdots                          \\
         \pderiv{\fa(\vx)}{x_n} \fb(\vx)
       \end{array}\right]
  \\&= \fa(\vx)\brs{\pderiv{\fb(\vx)}{\vx}} + \brs{\pderiv{\fa(\vx)}{\vx}}\fb(\vx)
\end{align*}
\end{proof}



%--------------------------------------
\begin{theorem}
\label{thm:mc_x}
\footnote{
  \citerp{scharf}{274},
  \citerp{vantrees4}{1398}
  }
%--------------------------------------
\lembox{
  \pderiv{}{\vx} \vx
    = \opI
  \qquad\qquad
  \forall \vx\in\vRn
  }
\end{theorem}
\begin{proof}
\begin{align*}
  \pderiv{}{\vx} \vx
    &= \left[\begin{array}{*{4}{>{\ds}c}}
         \pderiv{x_1}{x_1} & \pderiv{x_2}{x_1} & \cdots & \pderiv{x_n}{x_1} \\
         \pderiv{x_1}{x_2} & \pderiv{x_2}{x_2} & \cdots & \pderiv{x_n}{x_2} \\
         \vdots            & \vdots            & \ddots & \vdots            \\
         \pderiv{x_1}{x_n} & \pderiv{x_2}{x_n} & \cdots & \pderiv{x_n}{x_n}
       \end{array}\right]
    && \text{by \prefp{def:grad}}
  \\&= \left[\begin{array}{*{4}{>{\ds}c}}
         \kdelta_{11}      & \kdelta_{21}      & \cdots & \kdelta_{n1}      \\
         \kdelta_{12}      & \kdelta_{22}      & \cdots & \kdelta_{n2}      \\
         \vdots            & \vdots            & \ddots & \vdots            \\
         \kdelta_{1n}      & \kdelta_{2n}      & \cdots & \kdelta_{nn}      
       \end{array}\right]
    && \text{by \prefp{def:mc_x} (mutual independence property)}
  \\&= \left[\begin{array}{*{4}{>{\ds}c}}
         1                 & 0                 & \cdots & 0                 \\
         0                 & 1                 & \cdots & 0                 \\
         \vdots            & \vdots            & \ddots & \vdots            \\
         0                 & 0                 & \cdots & 1                 
       \end{array}\right]
    && \text{by definition of \prop{kronecker delta function} $\kdelta$}
  \\&= \opI
    && \text{by definition of \prop{identity operator} $\opI$}
\end{align*}
\end{proof}


%--------------------------------------
\begin{theorem}
%\footnote{
%\citerp{graham}{54}
%\citer{felippa}
%}
\label{thm:mc_Axx}
%--------------------------------------
\thmbox{
  \pderiv{}{\vx} \brp{\opA\vx}          
    = \opA^T
     + \sum\limits_{i=1}^n
       \brp{\pderiv{}{\vx}
       \left[\begin{array}{cccc} a_{1i} & a_{2i} & \cdots & a_{mi} \end{array}\right]} 
       x_i
  \qquad\qquad
  \forall \vx\in\vRn,\; \opA\in\vCm\times\vCn
  }
\end{theorem}
\begin{proof}
Let 
\[
   \vx \eqd
   \left[
      \begin{array}{c}
         x_1 \\
         x_2 \\
         \vdots \\
         x_n
      \end{array}
   \right]
   \qquad\qquad
   \opA \eqd
   \left[\begin{array}{ccccc}
     a_{11}   & a_{12}   & \cdots & a_{1n}   \\
     a_{21}   & a_{22}   & \cdots & a_{2n}   \\
     \vdots   & \vdots   & \ddots & \vdots \\
     a_{m1}   & a_{m2}   & \cdots & a_{mn}
   \end{array}\right]
\]

\begin{align*}
  \pderiv{}{\vx}\;\brp{\opA\vx}
    &= \pderiv{}{\vx} 
       \left(
         \left[\begin{array}{cccc}
           a_{11}   & a_{12}   & \cdots & a_{1n}   \\
           a_{21}   & a_{22}   & \cdots & a_{2n}   \\
           \vdots   & \vdots   & \ddots & \vdots \\
           a_{m1}   & a_{m2}   & \cdots & a_{mn}
         \end{array}\right]
         \left[\begin{array}{ccccc}
           x_1 \\
           x_2 \\
           \vdots            \\
           x_n
         \end{array}\right]
       \right)
    && \text{by definition of $A$ and $\vx$}
  \\&= \pderiv{}{\vx}
       \left[\begin{array}{ccccc}
         \sum\limits_{i=1}^n a_{1i}x_i   \\
         \sum\limits_{i=1}^n a_{2i}x_i   \\
         \vdots   \\
         \sum\limits_{i=1}^n a_{mi}x_i   \\
       \end{array}\right]
    && \text{by matrix multiplication}
  \\&= \pderiv{}{\vx}
       \sum\limits_{i=1}^n
       \left[\begin{array}{ccccc}
         a_{1i}x_i   \\
         a_{2i}x_i   \\
         \vdots   \\
         a_{mi}x_i   \\
       \end{array}\right]
  \\&= \sum\limits_{i=1}^n
       \pderiv{}{\vx}
       \left[\begin{array}{ccccc}
         a_{1i}x_i   \\
         a_{2i}x_i   \\
         \vdots   \\
         a_{mi}x_i   \\
       \end{array}\right]
  \\&= \sum\limits_{i=1}^n
       \left[\begin{array}{ccccc}
         \pderiv{a_{1i}x_i}{x_1} & \pderiv{a_{2i}x_i}{x_1} & \cdots & \pderiv{a_{mi}x_i}{x_1} \\
         \pderiv{a_{1i}x_i}{x_2} & \pderiv{a_{2i}x_i}{x_2} & \cdots & \pderiv{a_{mi}x_i}{x_2} \\
         \vdots            & \vdots              & \ddots & \vdots      \\          
         \pderiv{a_{1i}x_i}{x_n} & \pderiv{a_{2i}x_i}{x_n} & \cdots & \pderiv{a_{mi}x_i}{x_n} 
       \end{array}\right]
    && \text{by \prefp{def:grad}}
  \\&= \sum\limits_{i=1}^n
       \left[\begin{array}{ccccc}
         a_{1i}\pderiv{x_i}{x_1}+\pderiv{a_{1i}}{x_1}x_i & a_{2i}\pderiv{x_i}{x_1}+\pderiv{a_{2i}}{x_1}x_i & \cdots & a_{mi}\pderiv{x_i}{x_1}+\pderiv{a_{mi}}{x_1}x_i \\
         a_{1i}\pderiv{x_i}{x_2}+\pderiv{a_{1i}}{x_2}x_i & a_{2i}\pderiv{x_i}{x_2}+\pderiv{a_{2i}}{x_2}x_i & \cdots & a_{mi}\pderiv{x_i}{x_2}+\pderiv{a_{mi}}{x_2}x_i \\
         \vdots            & \vdots              & \ddots & \vdots      \\          
         a_{1i}\pderiv{x_i}{x_n}+\pderiv{a_{1i}}{x_n}x_i & a_{2i}\pderiv{x_i}{x_n}+\pderiv{a_{2i}}{x_n}x_i & \cdots & a_{mi}\pderiv{x_i}{x_n}+\pderiv{a_{mi}}{x_n}x_i 
       \end{array}\right]
    && \text{by \prefp{lem:mc_ab}}
  \\&= \sum\limits_{i=1}^n
       \left[\begin{array}{ccccc}
         a_{1i}\pderiv{x_i}{x_1} & a_{2i}\pderiv{x_i}{x_1} & \cdots & a_{mi}\pderiv{x_i}{x_1} \\
         a_{1i}\pderiv{x_i}{x_2} & a_{2i}\pderiv{x_i}{x_2} & \cdots & a_{mi}\pderiv{x_i}{x_2} \\
         \vdots            & \vdots              & \ddots & \vdots      \\          
         a_{1i}\pderiv{x_i}{x_n} & a_{2i}\pderiv{x_i}{x_n} & \cdots & a_{mi}\pderiv{x_i}{x_n} 
       \end{array}\right]
     + \sum\limits_{i=1}^n
       \left[\begin{array}{ccccc}
         \pderiv{a_{1i}}{x_1}x_i & \pderiv{a_{2i}}{x_1}x_i & \cdots & \pderiv{a_{mi}}{x_1}x_i \\
         \pderiv{a_{1i}}{x_2}x_i & \pderiv{a_{2i}}{x_2}x_i & \cdots & \pderiv{a_{mi}}{x_2}x_i \\
         \vdots            & \vdots              & \ddots & \vdots      \\          
         \pderiv{a_{1i}}{x_n}x_i & \pderiv{a_{2i}}{x_n}x_i & \cdots & \pderiv{a_{mi}}{x_n}x_i 
       \end{array}\right]
  \\
  \\
  \\&= \sum\limits_{i=1}^n
       \left[\begin{array}{ccccc}
         a_{1i}\kdelta_{i1} & a_{2i}\kdelta_{i1} & \cdots & a_{mi}\kdelta_{i1} \\
         a_{1i}\kdelta_{i2} & a_{2i}\kdelta_{i2} & \cdots & a_{mi}\kdelta_{i2} \\
         \vdots             & \vdots             & \ddots & \vdots             \\
         a_{1i}\kdelta_{in} & a_{2i}\kdelta_{in} & \cdots & a_{mi}\kdelta_{in} 
       \end{array}\right]
     + \sum\limits_{i=1}^n
       \brp{\pderiv{}{\vx}
       \left[\begin{array}{cccc} a_{1i} & a_{2i} & \cdots & a_{mi} \end{array}\right]} 
       x_i
    && \text{by Lemma~\ref{def:mc_x}}
  \\&= \left[\begin{array}{ccccc}
         a_{11}   & a_{21}   & \cdots & a_{m1}   \\
         a_{12}   & a_{22}   & \cdots & a_{m2}   \\
         \vdots   & \vdots   & \ddots & \vdots   \\
         a_{1n}   & a_{2n}   & \cdots & a_{mn}   
       \end{array}\right]
     + \sum\limits_{i=1}^n
       \brp{\pderiv{}{\vx}
       \left[\begin{array}{cccc} a_{1i} & a_{2i} & \cdots & a_{mi} \end{array}\right]} 
       x_i
    && \text{by definition of $\kdelta$}
  \\&= \opA^T
     + \sum\limits_{i=1}^n
       \brp{\pderiv{}{\vx}
       \left[\begin{array}{cccc} a_{1i} & a_{2i} & \cdots & a_{mi} \end{array}\right]} 
       x_i
\end{align*}
\end{proof}


%--------------------------------------
\begin{theorem}[\thmd{Affine equations}]
\footnote{
  \citerp{graham}{54}
  %\citer{felippa}
  }
\label{thm:mc_Ax}
%--------------------------------------
\thmbox{
  \text{$\opA$ and $\opB$ are independent of $\vx$}
  \implies
  \left\{\begin{array}{>{\ds}rc>{\ds}l@{\qquad}C}
    \pderiv{}{\vx} \brp{\opA\vx}          &=& \opA^T  & \forall \vx\in\vRn,\; \opA\in\vCm\times\vCn \\
    \pderiv{}{\vx} \brp{\vx^T \opB}       &=& \opB    & \forall \vx\in\vRn,\; \opB\in\vCn\times\vCm
  \end{array}\right.
  }
\end{theorem}
\begin{proof}
Let $\opB \eqd \opA^T$.

\begin{align*}
\intertext{1. Proof that $\pderiv{}{\vx}{\left(A\vx\right)}=\opA^T$:}
  \pderiv{}{\vx}\;\brp{\opA\vx}
    &= \opA^T 
     + \sum\limits_{i=1}^n
       \brp{\pderiv{}{\vx}
       \left[\begin{array}{cccc} a_{1i} & a_{2i} & \cdots & a_{mi} \end{array}\right]} 
       x_i
    && \text{by \prefp{thm:mc_Axx}}
  \\&= \opA^T 
     + \sum\limits_{i=1}^n
       \brs{\begin{array}{cccc} \pderiv{}{\vx}a_{1i} & \pderiv{}{\vx}a_{2i} & \cdots & \pderiv{}{\vx}a_{mi} \end{array}} 
       x_i
  \\&= \opA^T 
     + \sum\limits_{i=1}^n
       \cancelto{0}{\brs{\begin{array}{cccc} 0 & 0 & \cdots & 0 \end{array}}}
       x_i
    && \text{by left hypothesis}
  \\&= \opA^T 
\\
\intertext{2. Proof that $\pderiv{}{\vx}{\left(\vx^T \opB\right)}=\opB$:}
  \pderiv{}{\vx}{\left(\vx^T \opB\right)}
    &= \pderiv{}{\vx} \left(\vx^T \opA^T \right)
    && \text{by definition of $\opB$}
  \\&= \pderiv{}{\vx} \left[\left(\opA\vx \right)^T\right]
  \\&= \pderiv{}{\vx} \left(\opA\vx \right)
    && \text{by \prefp{def:grad}}
  \\&= \opA^T
    && \text{by \prefp{thm:mc_Ax}}
  \\&= \opB
    && \text{by definition of $\opB$}
\end{align*}
\end{proof}


%--------------------------------------
\begin{theorem}[Product rule]
\label{thm:mc_product_rule}
\footnote{
  \citerp{scharf}{274},
  \citerp{vantrees4}{1398}
  }
\index{product rule}
%--------------------------------------
Let $\vy$ and $\vz$ be functions of $\vx$ and 
\thmbox{
  \pderiv{}{\vx}\vz^T\vy = \pderiv{\vz}{\vx} \vy + \pderiv{\vy}{\vx} \vz 
  \qquad\qquad
  \forall \vx\in\vRn,\, \vy\in\vRm,\, \vz\in\vRm
  }
\end{theorem}
\begin{proof}
\begin{align*}
  \pderiv{}{\vx}\vz^T \vy
    &= \pderiv{}{\vx} \sum_{k=1}^m z_k y_k
  \\&= \sum_{k=1}^m \pderiv{}{\vx} z_k y_k
  \\&= \sum_{k=1}^m \pderiv{z_k}{\vx} y_k
     + \sum_{k=1}^m \pderiv{y_k}{\vx} z_k
    \qquad \text{by \prefp{lem:mc_ab}}
  \\&= \left[\begin{array}{ccccccc}
         \pderiv{z_1}{x_1} y_1 &+& \pderiv{z_2}{x_1} y_2 &+& \cdots &+& \pderiv{z_n}{x_1} y_n \\ 
         \pderiv{z_1}{x_1} y_1 &+& \pderiv{z_2}{x_1} y_2 &+& \cdots &+& \pderiv{z_n}{x_1} y_n \\ 
         \vdots                & &                       & & \ddots & & \vdots \\
         \pderiv{z_1}{x_1} y_1 &+& \pderiv{z_2}{x_1} y_2 &+& \cdots &+& \pderiv{z_n}{x_1} y_n \\ 
       \end{array}\right]
     + \left[\begin{array}{ccccccc}
         \pderiv{y_1}{x_1} z_1 &+& \pderiv{y_2}{x_1} z_2 &+& \cdots &+& \pderiv{y_n}{x_1} z_n \\ 
         \pderiv{y_1}{x_1} z_1 &+& \pderiv{y_2}{x_1} z_2 &+& \cdots &+& \pderiv{y_n}{x_1} z_n \\ 
         \vdots                & &                       & & \ddots & & \vdots \\
         \pderiv{y_1}{x_1} z_1 &+& \pderiv{y_2}{x_1} z_2 &+& \cdots &+& \pderiv{y_n}{x_1} z_n \\ 
       \end{array}\right]
  \\&= \left[\begin{array}{cccc}
         \pderiv{z_1}{x_1} & \pderiv{z_2}{x_1} & \cdots & \pderiv{z_n}{x_1}  \\ 
         \pderiv{z_1}{x_1} & \pderiv{z_2}{x_1} & \cdots & \pderiv{z_n}{x_1}  \\ 
         \vdots            &                   & \ddots & \vdots \\
         \pderiv{z_1}{x_1} & \pderiv{z_2}{x_1} & \cdots & \pderiv{z_n}{x_1}  \\ 
       \end{array}\right]
       \left[\begin{array}{c}
         y_1 \\
         y_2 \\
         \vdots \\
         y_n
       \end{array}\right]
     + \left[\begin{array}{cccc}
         \pderiv{y_1}{x_1} & \pderiv{y_2}{x_1} & \cdots & \pderiv{y_n}{x_1}  \\ 
         \pderiv{y_1}{x_1} & \pderiv{y_2}{x_1} & \cdots & \pderiv{y_n}{x_1}  \\ 
         \vdots            &                   & \ddots & \vdots \\
         \pderiv{y_1}{x_1} & \pderiv{y_2}{x_1} & \cdots & \pderiv{y_n}{x_1}  \\ 
       \end{array}\right]
       \left[\begin{array}{c}
         z_1 \\
         z_2 \\
         \vdots \\
         z_n
       \end{array}\right]
  \\&= \pderiv{\vz}{\vx} \vy + \pderiv{\vy}{\vx} \vz
\end{align*}
\end{proof}


%--------------------------------------
\begin{theorem}
\label{thm:mc_xAxx}
\index{matrix:quadratic form}
\index{quadratic form}
%--------------------------------------
\thmbox{
  \pderiv{}{\vx} \brp{\vx^T A \vx}
    = \opA\vx + \opA^T\vx
     + \brs{\sum\limits_{i=1}^n
       \brp{\pderiv{}{\vx}
       \left[\begin{array}{cccc} a_{1i} & a_{2i} & \cdots & a_{ni} \end{array}\right]} 
       x_i}\vx
  \qquad\scy
  \forall \vx\in\vRn,\, \opA\in\vRn\times\vRn
  }
\end{theorem}
\begin{proof}
\begin{align*}
  \pderiv{}{\vx}{\left( \vx ^T \opA \vx  \right)}
    &= \brs{\pderiv{}{\vx} \vx} \opA\vx + \brs{\pderiv{}{\vx}\opA\vx}\vx
    && \text{by \prefp{thm:mc_product_rule}}
  \\&= \opI\opA\vx + \brs{\opA^T
     + \sum\limits_{i=1}^n
       \brp{\pderiv{}{\vx}
       \left[\begin{array}{cccc} a_{1i} & a_{2i} & \cdots & a_{ni} \end{array}\right]} 
       x_i}\vx
    && \text{by \pref{thm:mc_x} and \pref{thm:mc_Axx}}
  \\&= \opA\vx + \opA^T\vx
     + \brs{\sum\limits_{i=1}^n
       \brp{\pderiv{}{\vx}
       \left[\begin{array}{cccc} a_{1i} & a_{2i} & \cdots & a_{ni} \end{array}\right]} 
       x_i}\vx
    && \text{by definition of identity operator $\opI$}
\end{align*}
\end{proof}

%--------------------------------------
\begin{theorem}[Quadratic form]
\footnote{
  \citerp{graham}{54}
  %\citen{felippa}
  }
\label{thm:mc_xAx}
\index{matrix:quadratic form}
\index{quadratic form}
%--------------------------------------
\thmbox{
  \text{$\opA$ is independent of $\vx$}
  \qquad\implies\qquad
  \pderiv{}{\vx} \brp{\vx^T A \vx} = A \vx  + A^T \vx 
  \qquad\qquad\scriptstyle
  \forall \vx\in\vRn,\, \opA\in\vRn\times\vRn
  }
\end{theorem}
\begin{proof}
\begin{align*}
  \pderiv{}{\vx}{\left( \vx ^T \opA \vx  \right)}
    &= \brs{\pderiv{}{\vx} \vx} \opA\vx + \brs{\pderiv{}{\vx}\opA\vx}\vx
    && \text{by \prefp{thm:mc_product_rule}}
  \\&= \opI\opA\vx + \opA^T \vx
    && \text{by \prefp{thm:mc_x} and \prefp{thm:mc_Ax}}
\end{align*}
\end{proof}


%--------------------------------------
\begin{corollary}
\footnote{
  \citerp{graham}{54}
  %\citen{felippa}
  }
\label{cor:mc_xAx}
\index{matrix:quadratic form}
\index{quadratic form}
%--------------------------------------
\corbox{\begin{array}{>{\ds}rcl@{\qquad}l}
  \pderiv{}{\vx }(\vx ^T\vx )              &=& 2\vx 
  \qquad\qquad
  \forall \vx\in\vRn
\end{array}}
\end{corollary}
\begin{proof}
\begin{align*}
  \pderiv{}{\vx}{(\vx ^T\vx )} 
    &= \pderiv{}{\vx}{(\vx ^T \opI \vx )} 
    && \text{by property of identity operator $I$}
  \\&= \opI\vx  + \opI^T\vx  
    && \text{by previous result 3.}
  \\&= \vx  + \vx  
    && \text{by property of identity operator $I$}
  \\&= 2\vx 
\end{align*}
\end{proof}



%--------------------------------------
\begin{theorem}[Chain rule]
\label{thm:mc_chain_rule}
\footnote{
  \citerpp{graham}{54}{55}
  }
\index{chain rule}
%--------------------------------------
Let $\vz$ be a function of $\vy$ and $\vy$ a function of $\vx$ and
\[
   \vx \eqd
   \left[\begin{array}{c}
     x_1    \\
     x_2    \\
     \vdots \\
     x_n
   \end{array}\right]
   \qquad\qquad
   \vy \eqd
   \left[\begin{array}{c}
     y_1    \\
     y_2    \\
     \vdots \\
     y_m
   \end{array}\right]
   \qquad\qquad
   \vz \eqd
   \left[\begin{array}{c}
     z_1    \\
     z_2    \\
     \vdots \\
     z_k
   \end{array}\right]
\]
\thmbox{
  \pderiv{}{\vx}\vz = \pderiv{\vy}{\vx} \pderiv{\vz}{\vy}           
  }
\end{theorem}
\begin{proof}
\begin{align*}
  \pderiv{\vz}{\vx}
    &= \left[\begin{array}{ccccc}
         \pderiv{z_1}{x_1} & \pderiv{z_2}{x_1} & \cdots & \pderiv{z_k}{x_1} \\
         \pderiv{z_1}{x_2} & \pderiv{z_2}{x_2} & \cdots & \pderiv{z_k}{x_2} \\
         \vdots            & \vdots            & \ddots & \vdots            \\
         \pderiv{z_1}{x_n} & \pderiv{z_2}{x_n} & \cdots & \pderiv{z_k}{x_n}
       \end{array}\right]
  \\&= \left[\begin{array}{ccccc}
         \ds\sum_{j=0}^m \pderiv{z_1}{y_j}\pderiv{y_j}{x_1} 
       & \ds\sum_{j=0}^m \pderiv{z_2}{y_j}\pderiv{y_j}{x_1} 
       & \cdots 
       & \ds\sum_{j=0}^m \pderiv{z_k}{y_j}\pderiv{y_j}{x_1}  
       \\
         \ds\sum_{j=0}^m \pderiv{z_1}{y_j}\pderiv{y_j}{x_2} 
       & \ds\sum_{j=0}^m \pderiv{z_2}{y_j}\pderiv{y_j}{x_2} 
       & \cdots 
       & \ds\sum_{j=0}^m \pderiv{z_k}{y_j}\pderiv{y_j}{x_2}  
       \\
         \vdots            & \vdots            & \ddots & \vdots            
       \\
         \ds\sum_{j=0}^m \pderiv{z_1}{y_j}\pderiv{y_j}{x_n} 
       & \ds\sum_{j=0}^m \pderiv{z_2}{y_j}\pderiv{y_j}{x_n} 
       & \cdots 
       & \ds\sum_{j=0}^m \pderiv{z_k}{y_j}\pderiv{y_j}{x_n}  
       \end{array}\right]
  \\&= \left[\begin{array}{ccccc}
          \pderiv{y_1}{x_1} &  \pderiv{y_2}{x_1} & \cdots &  \pderiv{y_m}{x_1}  \\
          \pderiv{y_1}{x_2} &  \pderiv{y_2}{x_2} & \cdots &  \pderiv{y_m}{x_2}  \\
          \vdots            &  \vdots            & \ddots & \vdots              \\
          \pderiv{y_1}{x_n} &  \pderiv{y_2}{x_n} & \cdots &  \pderiv{y_m}{x_n}  
       \end{array}\right]
       %
       \left[\begin{array}{ccccc}
          \pderiv{z_1}{y_1} & \pderiv{z_2}{y_1}  & \cdots &  \pderiv{z_k}{y_1}  \\                 
          \pderiv{z_1}{y_2} & \pderiv{z_2}{y_2}  & \cdots &  \pderiv{z_k}{y_2}  \\
          \vdots            & \vdots             & \ddots & \vdots              \\
          \pderiv{z_1}{y_m} & \pderiv{z_2}{y_m}  & \cdots &  \pderiv{z_k}{y_m}
       \end{array}\right]
  \\&= \pderiv{\vy}{\vx} \pderiv{\vz}{\vy}
\end{align*}
\end{proof}


%=======================================
\section{First derivative of a matrix with respect to a scalar}
%=======================================
%---------------------------------------
\begin{definition}
%---------------------------------------
Let $x\in\R$, $\set{y_{jk}\in\C}{j=1,2,\ldots,m;\;k=1,2,\ldots,n}$
and
\[
  Y = 
   \mcom{
   \left[\begin{array}{ccccc}
     y_{11}   & y_{12}   & \cdots & y_{1n}   \\
     y_{21}   & y_{22}   & \cdots & y_{2n}   \\
     \vdots   & \vdots   & \ddots & \vdots \\
     y_{m1}   & y_{m2}   & \cdots & y_{mn}
   \end{array}\right]
   }{$m\times n$ matrix}
\]
The {\bf derivative of $Y$ with respect to $x$} is
\defbox{
  \deriv{Y}{x}   \eqd
  \mcom{
  \left[\begin{array}{ccccc}
    \deriv{y_{11}}{x} & \deriv{y_{12}}{x} & \cdots & \deriv{y_{1n}}{x} \\
    \deriv{y_{21}}{x} & \deriv{y_{22}}{x} & \cdots & \deriv{y_{2n}}{x} \\
    \vdots            & \vdots            & \ddots & \vdots            \\
    \deriv{y_{m1}}{x} & \deriv{y_{m2}}{x} & \cdots & \deriv{y_{mn}}{x}
  \end{array}\right]
  }{$m\times n$ matrix}
  }
\end{definition}


%---------------------------------------
\begin{theorem}
\footnote{
  \citerpp{gradshteyn}{1106}{1107}
  }
%---------------------------------------
Let $x\in\R$, $\set{y_{jp}\in\C}{j=1,2,\ldots,m;\;p=1,2,\ldots,n}$,\\
$\set{w_{jp}\in\C}{j=1,2,\ldots,n;\;p=1,2,\ldots,k}$,
and
\[
  Y = 
   \mcom{
   \left[\begin{array}{ccccc}
     y_{11}   & y_{12}   & \cdots & y_{1n}   \\
     y_{21}   & y_{22}   & \cdots & y_{2n}   \\
     \vdots   & \vdots   & \ddots & \vdots \\
     y_{m1}   & y_{m2}   & \cdots & y_{mn}
   \end{array}\right]
   }{$m\times n$ matrix}
  \qquad\qquad
  W = 
   \mcom{
   \left[\begin{array}{ccccc}
     w_{11}   & w_{12}   & \cdots & w_{1k}   \\
     w_{21}   & w_{22}   & \cdots & w_{2k}   \\
     \vdots   & \vdots   & \ddots & \vdots \\
     w_{p1}   & w_{p2}   & \cdots & w_{pk}
   \end{array}\right]
   }{$p\times k$ matrix}
\]
\thmbox{\begin{array}{rcll}
  \deriv{}{x}\Big( Y+W \Big) 
    &=& \deriv{}{x}Y + \deriv{}{x}W
      & \text{(for $p=m$, $k=n$)}
  \\
  \deriv{}{x}\Big( YW \Big) 
    &=& \Big(\deriv{}{x}Y\Big)W + Y\Big(\deriv{}{x}W\Big)
      & \text{(for $p=n$)}
  \\
  \deriv{}{x}\Big( Y^T \Big) 
    &=& \Big(\deriv{}{x}Y\Big)^T
      & \text{}
  \\
  \deriv{}{x}\Big( Y^{-1} \Big) 
    &=& -Y^{-1} \Big(\deriv{}{x}Y\Big) Y^{-1}
      & \text{(for $m=n$ and $Y$ invertible)}
  \end{array}}
\end{theorem}
\begin{proof}
\begin{align*}
  \deriv{}{x}\Big( Y+W \Big)
    &= \deriv{}{x}
       \left(
       \left[\begin{array}{ccccc}
         y_{11}   & y_{12}   & \cdots & y_{1n}   \\
         y_{21}   & y_{22}   & \cdots & y_{2n}   \\
         \vdots   & \vdots   & \ddots & \vdots   \\
         y_{m1}   & y_{m2}   & \cdots & y_{mn}
       \end{array}\right]
       +
       \left[\begin{array}{ccccc}
         w_{11}   & w_{12}   & \cdots & w_{1n}   \\
         w_{21}   & w_{22}   & \cdots & w_{2n}   \\
         \vdots   & \vdots   & \ddots & \vdots   \\
         w_{m1}   & w_{m2}   & \cdots & w_{mn}
       \end{array}\right]
       \right)
  \\&= \deriv{}{x}
       \left[\begin{array}{ccccc}
         y_{11}+w_{11}  & y_{12}+w_{12} & \cdots & y_{1n}+w_{1n}   \\
         y_{21}+w_{21}  & y_{22}+w_{22} & \cdots & y_{2n}+w_{2n}   \\
         \vdots   & \vdots   & \ddots & \vdots   \\
         y_{m1}+w_{m1}  & y_{m2}+w_{m2} & \cdots & y_{mn}+w_{mn}
       \end{array}\right]
  \\&= \left[\begin{array}{ccccc}
         (y_{11}+w_{11})^\prime  & (y_{12}+w_{12})^\prime & \cdots & (y_{1n}+w_{1n})^\prime   \\
         (y_{21}+w_{21})^\prime  & (y_{22}+w_{22})^\prime & \cdots & (y_{2n}+w_{2n})^\prime   \\
         \vdots   & \vdots   & \ddots & \vdots   \\
         (y_{m1}+w_{m1})^\prime  & (y_{m2}+w_{m2})^\prime & \cdots & (y_{mn}+w_{mn})^\prime
       \end{array}\right]
  \\&= \left[\begin{array}{ccccc}
         y_{11}^\prime+w_{11}^\prime  & y_{12}^\prime+w_{12}^\prime & \cdots & y_{1n}^\prime+w_{1n}^\prime   \\
         y_{21}^\prime+w_{21}^\prime  & y_{22}^\prime+w_{22}^\prime & \cdots & y_{2n}^\prime+w_{2n}^\prime   \\
         \vdots   & \vdots   & \ddots & \vdots   \\
         y_{m1}^\prime+w_{m1}^\prime  & y_{m2}^\prime+w_{m2}^\prime & \cdots & y_{mn}^\prime+w_{mn}^\prime
       \end{array}\right]
  \\&= \left[\begin{array}{ccccc}
         y_{11}^\prime   & y_{12}^\prime   & \cdots & y_{1n}^\prime   \\
         y_{21}^\prime   & y_{22}^\prime   & \cdots & y_{2n}^\prime   \\
         \vdots   & \vdots   & \ddots & \vdots   \\
         y_{m1}^\prime   & y_{m2}^\prime   & \cdots & y_{mn}^\prime
       \end{array}\right]
       +
       \left[\begin{array}{ccccc}
         w_{11}^\prime   & w_{12}^\prime   & \cdots & w_{1n}^\prime   \\
         w_{21}^\prime   & w_{22}^\prime   & \cdots & w_{2n}^\prime   \\
         \vdots   & \vdots   & \ddots & \vdots   \\
         w_{m1}^\prime   & w_{m2}^\prime   & \cdots & w_{mn}^\prime
       \end{array}\right]
  \\&= \deriv{}{x}
       \left[\begin{array}{ccccc}
         y_{11}   & y_{12}   & \cdots & y_{1n}   \\
         y_{21}   & y_{22}   & \cdots & y_{2n}   \\
         \vdots   & \vdots   & \ddots & \vdots   \\
         y_{m1}   & y_{m2}   & \cdots & y_{mn}
       \end{array}\right]
       +
       \deriv{}{x}
       \left[\begin{array}{ccccc}
         w_{11}   & w_{12}   & \cdots & w_{1n}   \\
         w_{21}   & w_{22}   & \cdots & w_{2n}   \\
         \vdots   & \vdots   & \ddots & \vdots   \\
         w_{m1}   & w_{m2}   & \cdots & w_{mn}
       \end{array}\right]
  \\&= \deriv{}{x}Y + \deriv{}{x}W
  \\
  \\
  \deriv{}{x}\Big( YW \Big)
    &= \deriv{}{x}
       \left(
       \left[\begin{array}{ccccc}
         y_{11}   & y_{12}   & \cdots & y_{1n}   \\
         y_{21}   & y_{22}   & \cdots & y_{2n}   \\
         \vdots   & \vdots   & \ddots & \vdots   \\
         y_{m1}   & y_{m2}   & \cdots & y_{mn}
       \end{array}\right]
       \left[\begin{array}{ccccc}
         w_{11}   & w_{12}   & \cdots & w_{1k}   \\
         w_{21}   & w_{22}   & \cdots & w_{2k}   \\
         \vdots   & \vdots   & \ddots & \vdots   \\
         w_{n1}   & w_{n2}   & \cdots & w_{nk}
       \end{array}\right]
       \right)
  \\&= \deriv{}{x}
       \left[\begin{array}{ccccc}
         \ds\sum_{j=1}^n y_{1j}w_{j1} & \ds\sum_{j=1}^n y_{1j}w_{j2} & \cdots & \ds\sum_{j=1}^n y_{1j}w_{jk}  \\  
         \ds\sum_{j=1}^n y_{2j}w_{j1} & \ds\sum_{j=1}^n y_{2j}w_{j2} & \cdots & \ds\sum_{j=1}^n y_{2j}w_{jk}  \\  
         \vdots   & \vdots   & \ddots & \vdots   \\
         \ds\sum_{j=1}^n y_{mj}w_{j1} & \ds\sum_{j=1}^n y_{mj}w_{j2} & \cdots & \ds\sum_{j=1}^n y_{mj}w_{jk}      
       \end{array}\right]
  \\&= \deriv{}{x}
       \sum_{j=1}^n 
       \left[\begin{array}{ccccc}
         y_{1j}w_{j1} & y_{1j}w_{j2} & \cdots & y_{1j}w_{jk}  \\  
         y_{2j}w_{j1} & y_{2j}w_{j2} & \cdots & y_{2j}w_{jk}  \\  
         \vdots   & \vdots   & \ddots & \vdots   \\
         y_{mj}w_{j1} & y_{mj}w_{j2} & \cdots & y_{mj}w_{jk}      
       \end{array}\right]
  \\&= \sum_{j=1}^n \deriv{}{x}
       \left[\begin{array}{ccccc}
         y_{1j}w_{j1} & y_{1j}w_{j2} & \cdots & y_{1j}w_{jk}  \\  
         y_{2j}w_{j1} & y_{2j}w_{j2} & \cdots & y_{2j}w_{jk}  \\  
         \vdots   & \vdots   & \ddots & \vdots   \\
         y_{mj}w_{j1} & y_{mj}w_{j2} & \cdots & y_{mj}w_{jk}      
       \end{array}\right]
  \\&= \sum_{j=1}^n 
       \left[\begin{array}{ccccc}
         \deriv{}{x}(y_{1j}w_{j1}) & \deriv{}{x}(y_{1j}w_{j2}) & \cdots & \deriv{}{x}(y_{1j}w_{jk})  \\  
         \deriv{}{x}(y_{2j}w_{j1}) & \deriv{}{x}(y_{2j}w_{j2}) & \cdots & \deriv{}{x}(y_{2j}w_{jk})  \\  
         \vdots   & \vdots   & \ddots & \vdots   \\
         \deriv{}{x}(y_{mj}w_{j1}) & \deriv{}{x}(y_{mj}w_{j2}) & \cdots & \deriv{}{x}(y_{mj}w_{jk})      
       \end{array}\right]
  \\&= \sum_{j=1}^n 
       \left[\begin{array}{ccccc}
         \vdots   & \vdots   & \ddots & \vdots   \\
         y_{1j}^\prime w_{j1} + y_{1j}w_{j1}^\prime & y_{1j}^\prime w_{j2} + y_{1j}w_{j2}^\prime & \cdots & y_{1j}^\prime w_{jk} + y_{1j}w_{jk}^\prime  \\  
         y_{2j}^\prime w_{j1} + y_{2j}w_{j1}^\prime & y_{2j}^\prime w_{j2} + y_{2j}w_{j2}^\prime & \cdots & y_{2j}^\prime w_{jk} + y_{2j}w_{jk}^\prime  \\  
         y_{mj}^\prime w_{j1} + y_{mj}w_{j1}^\prime & y_{mj}^\prime w_{j2} + y_{mj}w_{j2}^\prime & \cdots & y_{mj}^\prime w_{jk} + y_{mj}w_{jk}^\prime      
       \end{array}\right]
  \\&= \sum_{j=1}^n 
       \left(
       \left[\begin{array}{ccccc}
         y_{1j}^\prime w_{j1} & y_{1j}^\prime w_{j2} & \cdots & y_{1j}^\prime w_{jk}  \\  
         y_{2j}^\prime w_{j1} & y_{2j}^\prime w_{j2} & \cdots & y_{2j}^\prime w_{jk}  \\  
         \vdots   & \vdots   & \ddots & \vdots   \\
         y_{mj}^\prime w_{j1} & y_{mj}^\prime w_{j2} & \cdots & y_{mj}^\prime w_{jk}      
       \end{array}\right]
       +
       \left[\begin{array}{ccccc}
         y_{1j}w_{j1}^\prime & y_{1j}w_{j2}^\prime & \cdots & y_{1j}w_{jk}^\prime  \\  
         y_{2j}w_{j1}^\prime & y_{2j}w_{j2}^\prime & \cdots & y_{2j}w_{jk}^\prime  \\  
         \vdots   & \vdots   & \ddots & \vdots   \\
         y_{mj}w_{j1}^\prime & y_{mj}w_{j2}^\prime & \cdots & y_{mj}w_{jk}^\prime      
       \end{array}\right]
       \right)
  \\&= \Big(\deriv{}{x}Y\Big)W + Y\Big(\deriv{}{x}W\Big)
  \\
  \\
  \deriv{}{x}\Big( Y^T \Big)
    &= \deriv{}{x}
       \left(
       \left[\begin{array}{ccccc}
         y_{11}   & y_{12}   & \cdots & y_{1n}   \\
         y_{21}   & y_{22}   & \cdots & y_{2n}   \\
         \vdots   & \vdots   & \ddots & \vdots   \\
         y_{m1}   & y_{m2}   & \cdots & y_{mn}
       \end{array}\right]^T
       \right)
  \\&= \deriv{}{x}
       \left[\begin{array}{ccccc}
         y_{11}   & y_{21}   & \cdots & y_{n1}   \\
         y_{12}   & y_{22}   & \cdots & y_{n2}   \\
         \vdots   & \vdots   & \ddots & \vdots   \\
         y_{1n}   & y_{2n}   & \cdots & y_{nm}     
       \end{array}\right]
  \\&= \left[\begin{array}{ccccc}
         y_{11}^\prime & y_{21}^\prime & \cdots & y_{n1}^\prime \\
         y_{12}^\prime & y_{22}^\prime & \cdots & y_{n2}^\prime \\
         \vdots   & \vdots   & \ddots & \vdots   \\
         y_{1n}^\prime & y_{2n}^\prime & \cdots & y_{nm}^\prime   
       \end{array}\right]
  \\&= \left[\begin{array}{ccccc}
         y_{11}^\prime   & y_{12}^\prime   & \cdots & y_{1n}^\prime   \\
         y_{21}^\prime   & y_{22}^\prime   & \cdots & y_{2n}^\prime   \\
         \vdots   & \vdots   & \ddots & \vdots   \\
         y_{m1}^\prime   & y_{m2}^\prime   & \cdots & y_{mn}^\prime
       \end{array}\right]^T
  \\&= \left(
       \deriv{}{x}
       \left[\begin{array}{ccccc}
         y_{11}   & y_{12}   & \cdots & y_{1n}   \\
         y_{21}   & y_{22}   & \cdots & y_{2n}   \\
         \vdots   & \vdots   & \ddots & \vdots   \\
         y_{m1}   & y_{m2}   & \cdots & y_{mn}
       \end{array}\right]
       \right)^T
  \\
  \\
  \deriv{}{x}\Big( Y^{-1} \Big) 
    &= \deriv{}{x} \frac{\mathrm{adj} Y}{|Y|}
  \\&\vdots
  \\&\text{no proof at this time}
  \\&\vdots
  \\&= -Y^{-1} \Big(\deriv{}{x}Y\Big) Y^{-1}
\end{align*}
\end{proof}

%=======================================
\section{Second derivative of a scalar with respect to a vector}
%=======================================
%--------------------------------------
\begin{definition}
\footnote{
  \citerp{lieb}{240},
  \citerp{horn}{167}
  }
\index{Hessian matrix|textbf}
%--------------------------------------
Let 
\[
   \vx \eqd
   \left[\begin{array}{c}
     x_1    \\
     x_2    \\
     \vdots \\
     x_n
   \end{array}\right]
\]
The \hid{Hessian matrix} of a scalar $y$ with respect to the vector $\vx$ is
\defbox{
  \pderiv{^2y}{\vx^2}
    = 
  \pderiv{}{\vx}\left( \pderiv{y}{\vx} \right)
    = 
  \pderiv{}{\vx}
  \left[\begin{array}{c}
    \pderiv{y}{x_1}  \\
    \pderiv{y}{x_2}  \\
    \vdots           \\
    \pderiv{y}{x_n}  
  \end{array}\right]
    =
  \mcom{
  \left[\begin{array}{ccccc}
    \pderiv{}{x_1}\pderiv{y}{x_1} & \pderiv{}{x_1}\pderiv{y}{x_2} & \cdots & \pderiv{}{x_1}\pderiv{y}{x_n} \\
    \pderiv{}{x_2}\pderiv{y}{x_1} & \pderiv{}{x_2}\pderiv{y}{x_2} & \cdots & \pderiv{}{x_2}\pderiv{y}{x_n} \\
    \vdots                        & \vdots                        & \ddots & \vdots            \\
    \pderiv{}{x_n}\pderiv{y}{x_1} & \pderiv{}{x_n}\pderiv{y}{x_2} & \cdots & \pderiv{}{x_n}\pderiv{y}{x_n}
  \end{array}\right]
  }{$n\times n$ matrix}
  }
\end{definition}



%=======================================
\section{Multiple derivatives of a vector with respect to a scalar}
%=======================================
%--------------------------------------
\begin{definition}
%\footnote{\url{http://mathworld.wolfram.com/Wronskian.html}}
\index{Wronskian}
%--------------------------------------
Let 
\[
   \vy \eqd
   \left[\begin{array}{c}
     y_1    \\
     y_2    \\
     \vdots \\
     y_m
   \end{array}\right]
\]
The derivative of a vector $\vy$ with respect to the scalar $x$ is
\defbox{
  \left[\begin{array}{r}
                   \vy \\
    \deriv{}{x}   \vy \\
    \deriv{^2}{x^2} \vy \\
    \vdots             \\
    \deriv{^n}{x^n} \vy
  \end{array}\right]
    =
  \mcom{
  \left[\begin{array}{rrrr}
                   y_1 &                y_2 & \cdots &                y_m  \\
    \deriv{}{x  } y_1 & \deriv{}{x  } y_2 & \cdots & \deriv{}{x  } y_m  \\
    \deriv{^2}{x^2} y_1 & \deriv{^2}{x^2} y_2 & \cdots & \deriv{^2}{x^2} y_m  \\
    \vdots             & \vdots             & \ddots & \vdots              \\
    \deriv{^n}{x^n} y_1 & \deriv{^n}{x^n} y_2 & \cdots & \deriv{^n}{x^n} y_m  
  \end{array}\right]
  }{$(n+1)\times m$ matrix}
  }
\end{definition}
